(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(3510);class a{constructor(e=0,t,r,i=1,a=0){this.attackPower=e,this.defensePower=t,this.defenderCurrentHp=r,this.remainingAmmoModifier=i,this.armorPenetration=a,this.calcValue=e=>{const{attackPower:t,remainingAmmoModifier:r,armorPenetration:i}=this,a=Math.max(1,e-i),s=Math.floor((t-a)*r);return Math.max(0,s)},this.random=()=>this.calcValue(this.defensePower.random())}get min(){return this.calcValue(this.defensePower.max)}get max(){return this.calcValue(this.defensePower.min)}get values(){const{defensePower:e,calcValue:t}=this;return e.values().map(t)}get isDeadly(){const{min:e,defenderCurrentHp:t}=this;return t<=e}get scratchDamageProbability(){const{values:e}=this;return e.filter(e=>e<=0).length/e.length}get scratchDamages(){const{defenderCurrentHp:e}=this;return Object(i.a)(e).map(t=>Math.floor(.06*e+.08*t))}get deadlyDamageProbability(){const{values:e,defenderCurrentHp:t}=this;return e.filter(e=>t-e<=0).length/e.length}get stopperDamages(){const{defenderCurrentHp:e}=this;return Object(i.a)(e).map(t=>Math.floor(.5*e+.3*t))}}a.calc=(e=0,t,r=1)=>new a(e,t,r).random()},140:function(e,t,r){"use strict";r.r(t);var i=r(489);r.d(t,"AntiAirCutin",(function(){return i.a}));var a=r(3248);r.d(t,"CarrierBasedAerialCombat",(function(){return a.a}));var s=r(3249);r.d(t,"LandBaseAerialSupport",(function(){return s.a}));var n=r(210);r.d(t,"FleetAntiAir",(function(){return n.a}));var o=r(257);r.d(t,"ShipAntiAir",(function(){return o.a}))},151:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s}));const i=({accuracy:e,evasion:t,moraleModifier:r})=>{const i=(e-t)*r;return i<10?10:i>96?96:i},a=e=>{const{criticalRateMultiplier:t,hitRateBonus:r=0,criticalRateBonus:a=0}=e,s=i(e),n=Math.floor(s+1+r),o=Math.floor(Math.sqrt(s)*t+1+100*a),c=Math.min(n/100,1),l=Math.min(o/100,1);return{total:c,criticalRate:l,normalRate:c-l}},s=e=>{const t=Math.random();return t<e.criticalRate?"Critical":t<e.total?"Normal":"Miss"}},186:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a}));const i=([e,t],r)=>Math.floor((t-e)*r/99+e),a=([e,t],r)=>{let i=e;return r>=100&&(i+=e>=91?9:e>=70?8:e>=50?7:e>=40?6:e>=30?5:e>=8?4:3),Math.min(i,t)}},210:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(491),a=r(3921),s=r(493);const n=e=>{const{name:t,antiAir:r,improvement:i}=e;if(0===r)return 0;let a=0;return a=e.is("AntiAircraftFireDirector")||e.is("HighAngleMount")?.35:e.is("AntiAircraftShell")?.6:e.is("Radar")?.4:"46cm三連装砲"===t?.25:.2,a*r+i.fleetAntiAirModifier},o=e=>Math.floor(e.totalEquipmentStats(n));class c{constructor(e,t,r){this.ships=e,this.side=t,this.formationModifier=r}get fleetAntiAir(){const{ships:e,side:t,formationModifier:r}=this,i=Object(s.a)(e,o),a=2*Math.floor(r*i);return"Player"===t?a/1.3:a}}c.getCombinedFleetModifier=(e,t)=>e===i.a.EscortFleet?.48:t===a.a.AirDefenseBattle?.72:.8,c.calcFleetAntiAir=(e,t,r)=>{const{totalShipStats:i}=e,a=i(o),s=2*Math.floor(r*a);return"Player"===t?s/1.3:s}},218:function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return n}));var i=r(466),a=r(54);const s=e=>{const{shipType:t,shipClass:r,isInstallation:i,hasGear:a}=e;return t.isAircraftCarrierClass||(r.is("RevisedKazahayaClass")||i)&&(a("DiveBomber")||a("TorpedoBomber"))?"CarrierShelling":"Shelling"};class n{constructor(e){this.ship=e,this.getProficiencyModifiers=(e=!1)=>"Shelling"===this.type?{power:1,hitRate:0,criticalRate:0}:e?this.ship.getSpecialProficiencyModifiers():this.ship.getNormalProficiencyModifiers(),this.calcBasicPower=(e,t=!1)=>{const{ship:r}=this,{firepower:i}=r.stats;let a;return a=t?r.totalEquipmentStats(e=>e.is("TorpedoBomber")?0:e.improvement.shellingPowerModifier):r.totalEquipmentStats(e=>e.improvement.shellingPowerModifier),5+i+a+e},this.getCarrierShellingFm=(e=!1)=>{const{ship:t,type:r}=this;if("Shelling"===r)return;const i=e?0:t.totalEquipmentStats("torpedo"),a=e?t.totalEquipmentStats(e=>e.is("AntiInstallationBomber")?e.bombing:0):t.totalEquipmentStats("bombing"),s=Math.floor(Math.floor(1.3*a)+i)+15;return e=>25+Math.floor(1.5*(e+s))},this.calcPower=e=>{const{fleetFactor:t,formationModifier:r,engagementModifier:i,isCritical:s,isAntiInstallation:n,isArmorPiercing:o,specialAttack:c}=e,l=this.calcBasicPower(t,n),{ship:u}=this,h=u.health.shellingPowerModifier,d=u.getCruiserFitBonus(),p=c?c.modifier.power:1,f=this.getProficiencyModifiers(null==c?void 0:c.isCarrierSpecialAttack).power;let g={a14:r*i*h,b14:d,a11:p};e.modifiers&&(g=Object(a.a)(g,e.modifiers));const m=this.getCarrierShellingFm(n);return Object(a.b)({basic:l,cap:220,modifiers:g,fm14prev:m,fm11next:e=>(o&&(e=this.apShellFm(e)),s&&(e=Object(a.c)(f)(e)),e)})},this.calcAccuracy=e=>{const{shipAccuracy:t,equipmentAccuracy:r,improvementModifier:i,moraleModifier:a}=this.accuracyShipFactors,{fleetFactor:s,formationModifier:n,specialAttackModifier:o,isArmorPiercing:c,fitGunBonus:l}=e;let u=1;c&&(u=this.apShellModifiers.accuracy);const h=Math.floor(s+t+r+i);return Math.floor((h*n*a+l)*o*u)}}get type(){return s(this.ship)}get apShellModifiers(){const{hasGear:e}=this.ship;return Object(i.b)({hasMainGun:e("MainGun"),hasArmorPiercingShell:e("ArmorPiercingShell"),hasSecondaryGun:e("SecondaryGun"),hasRader:e("Radar")})}get apShellFm(){const e=this.apShellModifiers.power;return t=>Math.floor(t*e)}get accuracyShipFactors(){const{ship:e}=this,{shipAccuracy:t}=e;return{shipAccuracy:t,equipmentAccuracy:e.totalEquipmentStats("accuracy"),improvementModifier:e.totalEquipmentStats(e=>e.improvement.shellingAccuracyModifier),moraleModifier:e.morale.getAccuracyModifier("shelling")}}}},219:function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return c})),r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return u}));var i=r(45);const a=[{attackerFleetType:i.a.CarrierTaskForce,defenderFleetType:i.a.Single,factors:[2,10]},{attackerFleetType:i.a.SurfaceTaskForce,defenderFleetType:i.a.Single,factors:[10,-5]},{attackerFleetType:i.a.TransportEscort,defenderFleetType:i.a.Single,factors:[-5,10]},{attackerFleetType:i.a.Single,defenderFleetType:i.a.Combined,factors:[5,5]},{attackerFleetType:i.a.CarrierTaskForce,defenderFleetType:i.a.Combined,factors:[2,-5]},{attackerFleetType:i.a.SurfaceTaskForce,defenderFleetType:i.a.Combined,factors:[2,-5]},{attackerFleetType:i.a.TransportEscort,defenderFleetType:i.a.Combined,factors:[-5,-5]}],s=[{attackerFleetType:i.a.Single,defenderFleetType:i.a.CarrierTaskForce,factors:[10,5]},{attackerFleetType:i.a.Single,defenderFleetType:i.a.SurfaceTaskForce,factors:[5,-5]},{attackerFleetType:i.a.Single,defenderFleetType:i.a.TransportEscort,factors:[10,5]}],n=[{fleetType:i.a.CarrierTaskForce,factors:[78,43]},{fleetType:i.a.SurfaceTaskForce,factors:[46,70]},{fleetType:i.a.TransportEscort,factors:[51,46]}],o=(e,t)=>{if(!e.fleetType.isCombined&&!t.fleetType.isCombined)return 0;const r="Main"===e.role?0:1;if("Player"===e.side){const i=a.find(r=>r.attackerFleetType===e.fleetType&&r.defenderFleetType===t.fleetType);return i?i.factors[r]:0}if(e.fleetType.isCombined)return[10,-5][r];const i=s.find(r=>r.attackerFleetType===e.fleetType&&r.defenderFleetType===t.fleetType);return i?i.factors[r]:0},c=(e,t)=>{const r=r=>e.side===r?e.fleetType:t.fleetType,i=r("Player").isCombined,a=r("Enemy").isCombined;return i||a?i&&!a?0:15:5},l=({fleetType:e,role:t})=>{var r;const i="Main"===t?0:1,a=null===(r=n.find(t=>t.fleetType===e))||void 0===r?void 0:r.factors[i];return null!=a?a:90},u=(e,t)=>{const r=o(e,t),i=l(e);return{shelling:r,torpedo:c(e,t),shellingAccuracy:i}}},25:function(e,t,r){"use strict";var i=r(69);r.d(t,"a",(function(){return i}))},257:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const i=e=>{const{antiAir:t,improvement:r}=e;if(0===t)return 0;let i=0;return e.is("AntiAircraftGun")?i=6:e.is("AntiAircraftFireDirector")||e.is("HighAngleMount")?i=4:e.is("Radar")&&(i=3),i*t+r.adjustedAntiAirModifier};class a{constructor(e,t,r,i=1,a){this.ship=e,this.side=t,this.fleetAntiAir=r,this.combinedFleetModifier=i,this.antiAirCutin=a,this.calcAdjustedAntiAir=(e=1)=>{const t=this.internalAdjustedAA;return e<1?2*Math.floor(t*e):2*t},this.calcProportionalShotdownRate=(e=1)=>{const{combinedFleetModifier:t}=this,r=this.calcAdjustedAntiAir(e);return Math.floor(r)*t*.5*.25*.02},this.calcFixedShotdownNumber=(e=1,t=1)=>{const{fleetAntiAir:r,side:i,antiAirCutin:a,combinedFleetModifier:s}=this,n=this.calcAdjustedAntiAir(e);let o=.25*(.5*(Math.floor(n)+Math.floor(r*t)))*("Player"===i?.8:.75)*s;return a&&(o*=a.fixedAirDefenseModifier),Math.floor(o)},this.getShotdownNumber=({slotSize:e,adjustedAntiAirResistModifier:t,fleetAntiAirResistModifier:r})=>{let i=0;if(Math.random()>.5){const r=this.calcProportionalShotdownRate(t);i+=Math.floor(e*r)}if(Math.random()>.5){const e=this.calcFixedShotdownNumber(t,r);i+=Math.floor(e)}return i+=this.minimumBonus,i}}get internalAdjustedAA(){const{ship:e,side:t}=this;return((e,t)=>{const{stats:r,nakedStats:a,totalEquipmentStats:s}=e,n=s(i);if("Enemy"===t)return Math.floor(Math.sqrt(r.antiAir))+.5*n;const o=.5*(a.antiAir+n);return 0===e.countGear()?o:Math.floor(o)})(e,t)}get adjustedAntiAir(){return this.calcAdjustedAntiAir()}get minimumBonus(){const{side:e,antiAirCutin:t}=this;return t?t.minimumBonus:"Player"===e?1:0}get antiAirPropellantBarrageChance(){const{ship:e,adjustedAntiAir:t}=this,{shipType:r}=e;if(!(i=r).isAircraftCarrierClass&&!i.any("AviationCruiser","AviationBattleship","SeaplaneTender"))return 0;var i;const a=e.countGear(274);if(!a)return 0;const s=e.shipClass.is("IseClass")?.25:0;return(t+.9*e.stats.luck)/281+.15*(a-1)+s}}},258:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(326),a=r(3914),s=r(491),n=r(210);class o{constructor(e,t,r,a,s){this.side=e,this.fleetType=t,this.landBase=r,this.mainFleet=a,this.escortFleet=s,this.formation=i.a.LineAhead,this.name="",this.isCombinedFleet&&(this.formation=i.a.CruisingFormation4)}get allShips(){const{mainFleet:e,escortFleet:t}=this,r=e.nonNullableShips.concat();return t?r.concat(t.nonNullableShips):r}get fleetAntiAir(){const{allShips:e,side:t,formation:r}=this;return new n.a(e,t,r.fleetAntiAirModifier).fleetAntiAir}get isCombinedFleet(){return this.fleetType!==a.a.Single}getShipInformation(e){const{mainFleet:t,escortFleet:r,side:i,fleetType:a,fleetAntiAir:n,formation:o}=this,c={side:i,fleetType:a,fleetAntiAir:n,formation:o};if(t.nonNullableShips.find(t=>t===e))return Object.assign(Object.assign({},c),{fleetRole:s.a.MainFleet});if(!r)return;return r.nonNullableShips.find(t=>t===e)?Object.assign(Object.assign({},c),{fleetRole:s.a.EscortFleet}):void 0}}},259:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t,r){this.player=e,this.enemy=t,this.battleType=r}getShipInformation(e){const{player:t,enemy:r}=this,i=t.getShipInformation(e);if(i)return i;const a=r.getShipInformation(e);if(a)return a;throw console.error("ship info is not found")}}},270:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(54);const a={createPower:e=>{const{nakedAsw:t,equipmentAsw:r,improvementModifier:a,typeConstant:s,formationModifier:n,engagementModifier:o,healthModifier:c,synergyModifier:l,optionalModifiers:u,fm11next:h}=e,d=2*Math.sqrt(t)+1.5*r+a+s,p=n*o*c*l,f=u?Object(i.a)(u,{a14:p}):{a14:p};return Object(i.b)({basic:d,cap:170,modifiers:f,fm11next:h})},calcAccuracy:e=>{const{shipAccuracy:t,aswEquipmentModifier:r,improvementModifier:i,formationModifier:a,moraleModifier:s}=e;return(80+t+r+i)*a*s}}},303:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(3512),a=r(327),s=r(257),n=r(210);class o{constructor(e){this.combatInformation=e,this.shotdownInFighterCombat=(e,t,r)=>{let i;if("Player"===r){const e=t/4,r=Math.floor(t/3*100);i=Math.floor(Math.random()*(r+1))/100+e}else{const e=11-t;i=.35*Math.floor(Math.random()*(e+1))+.65*Math.floor(Math.random()*(e+1))}const a=i/10,s=Math.floor(e.slotSize*a);e.is("JetPoweredAircraft")?e.shotdown(.6*s):e.shotdown(s)},this.shipAntiAirDefense=(e,t,r)=>{const{battleType:i}=this.combatInformation,{side:a,fleetRole:o,fleetAntiAir:c}=this.combatInformation.getShipInformation(e),l=n.a.getCombinedFleetModifier(o,i),u=new s.a(e,a,c,l,r).getShotdownNumber(t);t.shotdown(u)}}fighterCombat(e,t){const r=e.reduce((e,t)=>e+t.fighterPower,0),i=t.reduce((e,t)=>e+t.fighterPower,0),s=a.a.fromFighterPower(r,i);return e.forEach(e=>this.shotdownInFighterCombat(e,s.constant,"Player")),t.forEach(e=>this.shotdownInFighterCombat(e,s.constant,"Enemy")),s}antiAirDefense(e,t,r){for(const a of t){const t=e[Object(i.a)(e.length-1)];this.shipAntiAirDefense(t,a,r)}}}},3247:function(e,t,r){"use strict";var i=r(140);r.d(t,"a",(function(){return i}))},3248:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(303),a=r(489);class s extends i.a{constructor(e){super(e);const{player:t,enemy:r}=this.combatInformation;t.isCombinedFleet&&r.isCombinedFleet?(this.playerAntiAirDefenseShips=t.allShips,this.enemyAntiAirDefenseShips=r.allShips):(this.playerAntiAirDefenseShips=t.mainFleet.nonNullableShips,this.enemyAntiAirDefenseShips=r.mainFleet.nonNullableShips)}main(){const{playerAntiAirDefenseShips:e,enemyAntiAirDefenseShips:t,combatInformation:r}=this,i=e.flatMap(({planes:e})=>e),s=t.flatMap(({planes:e})=>e),n=e=>e.is("DiveBomber")||e.is("TorpedoBomber")||e.is("Fighter"),o=i.filter(n),c=s.filter(n),l=this.fighterCombat(o,c),{player:u,enemy:h}=r,d=o.filter(e=>e.slotSize>0&&e.participatesInAirstrike),p=c.filter(e=>e.slotSize>0&&e.participatesInAirstrike);return this.antiAirDefense(e,p,a.a.try(u.allShips)),this.antiAirDefense(t,d,a.a.try(u.allShips)),{airControlState:l}}}},3249:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(3923),a=r(327),s=r(303);class n extends s.a{constructor(e,t){super(e),this.landBasedAirCorps=t}main(){const{enemy:e}=this.combatInformation,{fighterPower:t,planes:r}=this.landBasedAirCorps,s=Object(i.a)(e.allShips,({planes:e})=>e),n=s.reduce((e,t)=>e+t.fighterPower,0),o=a.a.fromFighterPower(t,n),c=e=>e.is("DiveBomber")||e.is("TorpedoBomber")||e.is("Fighter")||e.is("ReconnaissanceAircraft"),l=r.filter(c),u=s.filter(c);l.forEach(e=>this.shotdownInFighterCombat(e,o.constant,"Player")),u.forEach(e=>this.shotdownInFighterCombat(e,o.constant,"Enemy"));const h=l.filter(e=>e.slotSize>0&&e.participatesInAirstrike);return this.antiAirDefense(e.allShips,h),{airControlState:o}}}},326:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t,r){this.id=e,this.name=t,this.modifiers=r,this.getModifiers=e=>this!==i.Vanguard?this.modifiers:"Main"===e?Object.assign(Object.assign({},this.modifiers),{shelling:{power:.5,accuracy:.8,evasion:1},torpedo:{power:1,accuracy:.75,evasion:1},asw:{power:1,accuracy:1,evasion:1},night:{power:.5,accuracy:1,evasion:1}}):Object.assign(Object.assign({},this.modifiers),{shelling:{power:1,accuracy:1.2,evasion:1},torpedo:{power:1,accuracy:.95,evasion:1},asw:{power:.6,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.values.push(this)}static get singleFleetFormations(){return i.values.filter(e=>e.id<=10)}static get combinedFleetFormations(){return i.values.filter(e=>e.id>10)}static fromId(e){return i.values.find(t=>t.id===e)}get fleetAntiAirModifier(){return this.modifiers.fleetAntiAir}get isCombinedFleetFormation(){return this.id>10}get shellingSupportModifiers(){return this===i.Vanguard?{power:.5,accuracy:.8}:this.isCombinedFleetFormation?{power:1,accuracy:1}:this.getModifiers("Main").shelling}get protectionRate(){return this===i.LineAhead?.45:this===i.Diamond?.75:.6}}i.keys=["LineAhead","DoubleLine","Diamond","Echelon","LineAbreast","Vanguard","CruisingFormation1","CruisingFormation2","CruisingFormation3","CruisingFormation4"].concat(),i.values=[],i.LineAhead=new i(1,"単縦陣",{fleetAntiAir:1,shelling:{power:1,accuracy:1,evasion:1},torpedo:{power:1,accuracy:1,evasion:1},asw:{power:.6,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.DoubleLine=new i(2,"複縦陣",{fleetAntiAir:1.2,shelling:{power:.8,accuracy:1.2,evasion:1},torpedo:{power:.8,accuracy:.8,evasion:1},asw:{power:.8,accuracy:1.2,evasion:1},night:{power:1,accuracy:.9,evasion:1}}),i.Diamond=new i(3,"輪形陣",{fleetAntiAir:1.6,shelling:{power:.7,accuracy:1,evasion:1.1},torpedo:{power:.7,accuracy:.4,evasion:1.1},asw:{power:1.2,accuracy:1,evasion:1},night:{power:1,accuracy:.7,evasion:1}}),i.Echelon=new i(4,"梯形陣",{fleetAntiAir:1,shelling:{power:.75,accuracy:1.2,evasion:1.2},torpedo:{power:.6,accuracy:.6,evasion:1.3},asw:{power:1.1,accuracy:1.2,evasion:1.3},night:{power:1,accuracy:.9,evasion:1.2}}),i.LineAbreast=new i(5,"単横陣",{fleetAntiAir:1,shelling:{power:.6,accuracy:1.2,evasion:1.3},torpedo:{power:.6,accuracy:.3,evasion:1.4},asw:{power:1.3,accuracy:1.2,evasion:1.1},night:{power:1,accuracy:.8,evasion:1.2}}),i.Vanguard=new i(6,"警戒陣",{fleetAntiAir:1.1,shelling:{power:1,accuracy:1,evasion:1},torpedo:{power:1,accuracy:1,evasion:1},asw:{power:1,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.CruisingFormation1=new i(11,"第一警戒航行序列",{fleetAntiAir:1.1,shelling:{power:.8,accuracy:1,evasion:1},torpedo:{power:.7,accuracy:1,evasion:1},asw:{power:1.3,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.CruisingFormation2=new i(12,"第二警戒航行序列",{fleetAntiAir:1,shelling:{power:1,accuracy:1,evasion:1},torpedo:{power:.9,accuracy:1,evasion:1},asw:{power:1.1,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.CruisingFormation3=new i(13,"第三警戒航行序列",{fleetAntiAir:1.5,shelling:{power:.7,accuracy:1,evasion:1},torpedo:{power:.6,accuracy:1,evasion:1},asw:{power:1,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.CruisingFormation4=new i(14,"第四警戒航行序列",{fleetAntiAir:1,shelling:{power:1.1,accuracy:1.1,evasion:1},torpedo:{power:1,accuracy:1,evasion:1},asw:{power:.7,accuracy:1,evasion:1},night:{power:1,accuracy:1,evasion:1}}),i.isIneffective=(e,t)=>[[i.DoubleLine,i.LineAbreast],[i.LineAbreast,i.Echelon],[i.Echelon,i.LineAhead]].some(r=>r[0]===e&&r[1]===t)},327:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t,r){this.id=e,this.name=t,this.constant=r,i.values.push(this)}static fromFighterPower(e,t){const r=i.getBoundaryValues(t);return e>=r.AirSupremacy?i.AirSupremacy:e>=r.AirSuperiority?i.AirSuperiority:e>=r.AirParity?i.AirParity:e>=r.AirDenial?i.AirDenial:i.AirIncapability}static fromId(e){return i.values.find(t=>t.id===e)}get contactMultiplier(){switch(this){case i.AirSupremacy:return 3;case i.AirSuperiority:return 2;case i.AirDenial:return 1;default:return 0}}}i.values=[],i.AirSupremacy=new i(1,"制空権確保",1),i.AirSuperiority=new i(2,"航空優勢",3),i.AirParity=new i(0,"制空均衡",5),i.AirDenial=new i(3,"航空劣勢",7),i.AirIncapability=new i(4,"制空権喪失",10),i.getBoundaryValues=e=>({AirSupremacy:Math.ceil(3*e),AirSuperiority:Math.ceil(1.5*e),AirParity:Math.floor(2/3*e)+1,AirDenial:Math.floor(1/3*e)+1})},3447:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(54),a=r(218),s=r(485),n=r(486),o=r(487),c=r(488);const l=({ship:e,target:t,fleetFactors:r,formation:l,role:u,engagement:h,isArmorPiercing:d,nightContactModifier:p,optionalPowerModifiers:f})=>{const g=l.getModifiers(u),m=h.modifier,A=t.isInstallation,y=e.getSpecialEnemyModifiers(t),M=new a.a(e),b=new s.a(e),S=n.a.fromShip(e),w=o.a.fromShip(e,"Day"),C=new c.a(e);return{calcShellingPower:(e,t)=>{const a=Object(i.a)(y,f);return M.calcPower({fleetFactor:r.shelling,formationModifier:g.shelling.power,engagementModifier:m,modifiers:a,isCritical:e,isAntiInstallation:A,isArmorPiercing:d,specialAttack:t})},calcShellingSupportPower:e=>{const t=l.shellingSupportModifiers.power;return b.calcPower({formationModifier:t,engagementModifier:m,isCritical:e,isAntiInstallation:A})},calcTorpedoPower:e=>S.calcPower({fleetFactor:r.torpedo,formationModifier:g.torpedo.power,engagementModifier:m,isCritical:e,optionalModifiers:f}),calcAswPower:e=>w.calcPower({formationModifier:g.asw.power,engagementModifier:m,isCritical:e,optionalModifiers:f}),calcNightPower:(e,t)=>{const r=Object(i.a)(y,f);return C.calcPower({formationModifier:g.night.power,nightContactModifier:p,specialAttack:t,modifiers:r,isCritical:e,isAntiInstallation:A})},canDoTorpedoAttack:e.nakedStats.torpedo>0,canDoAsw:"None"!==w.type}}},3459:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return s}));const i=e=>{if(!e.shipType.isAircraftCarrierClass)return!1;return!(![545,599,610].includes(e.shipId)&&!e.hasGear(e=>[258,259].includes(e.gearId)))&&e.planes.some(e=>e.slotSize>0&&e.isNightPlane)},a=e=>{const{nakedStats:t,level:r}=e;return t.luck<50?Math.floor(t.luck+15+.75*Math.sqrt(r)):Math.floor(Math.sqrt(t.luck-50)+65+.8*Math.sqrt(r))};class s{constructor(e,t,r,i){this.id=e,this.name=t,this.typeFactor=r,this.modifier=i,this.calcRate=e=>this===s.DoubleAttack?109/110:Math.ceil(e)/this.typeFactor}get api(){return Math.floor(this.id)}get isDestroyerCutin(){return 7===this.id||8===this.id}get isAerialAttack(){return 6===this.api}}s.DoubleAttack=new s(1,"連撃",110,{power:1.2,accuracy:1.1}),s.MainTorp=new s(2,"主魚",115,{power:1.3,accuracy:1.5}),s.TorpTorp=new s(3,"魚雷",122,{power:1.5,accuracy:1.65}),s.SubmarineTorpTorp=new s(3.1,"潜水魚雷",110,{power:1.65,accuracy:1}),s.SubmarineRadarTorp=new s(3.2,"潜水電探",102,{power:1.75,accuracy:1}),s.MainMainSecond=new s(4,"主副",130,{power:1.75,accuracy:1.65}),s.MainMainMain=new s(5,"主砲",140,{power:2,accuracy:1.5}),s.AerialAttack1=new s(6.1,"夜襲1.25",105,{power:1.25,accuracy:1}),s.AerialAttack2=new s(6.2,"夜襲1.20",115,{power:1.2,accuracy:1}),s.AerialAttack3=new s(6.3,"夜襲1.18",125,{power:1.18,accuracy:1}),s.SuiseiAttack=new s(6.4,"彗星夜襲",115,{power:1.2,accuracy:1}),s.MainTorpRadar=new s(7,"主魚電",130,{power:1.3,accuracy:1}),s.TorpRadarLookout=new s(8,"魚見電",150,{power:1.2,accuracy:1}),s.getPossibleAerialAttacks=e=>{const t=[],r=e.planes.filter(e=>e.slotSize>0),i=r.filter(e=>e.isNightFighter).length,a=r.filter(e=>e.isNightAttacker).length,n=r.filter(e=>e.isNightPlane).length,o=r.filter(e=>e.isNightAircraft&&!e.isNightPlane).length,c=i>=1,l=a>=1,u=n>=1,h=r.some(e=>320===e.gear.gearId);return i>=2&&l&&t.push(s.AerialAttack1),c&&l&&t.push(s.AerialAttack2),u&&h&&t.push(s.SuiseiAttack),c?((i+o>=3||a+o>=2)&&t.push(s.AerialAttack3),t):t},s.getPossibleAttacks=(e,t=!1)=>{const{shipType:r,hasGear:a,countGear:n}=e,o=new Array;if(i(e))return s.getPossibleAerialAttacks(e);if(!e.canNightAttack)return o;const c=t?0:n(e=>[213,214,383].includes(e.gearId)),l=t?0:n("Torpedo")+n("SubmarineTorpedo");r.is("Destroyer")&&a(e=>e.is("SurfaceRadar"))&&l>=1&&(a(e=>e.is("SmallCaliberMainGun"))&&o.push(s.MainTorpRadar),a(129)&&o.push(s.TorpRadarLookout));const u=n(e=>e.is("MainGun")),h=n(e=>e.is("SecondaryGun"));return c>=1&&a(e=>e.is("SubmarineEquipment"))?o.push(s.SubmarineRadarTorp):c>=2?o.push(s.SubmarineTorpTorp):u>=3?o.push(s.MainMainMain):u>=2&&h>=1?o.push(s.MainMainSecond):l>=2?o.push(s.TorpTorp):u>=1&&l>=1?o.push(s.MainTorp):u+h>=2&&o.push(s.DoubleAttack),o},s.calcPreModifierValue=a,s.calcBaseValue=(e,t,r,i)=>{let s=a(e);return t&&(s+=15),"Chuuha"===e.health.damage&&(s+=18),e.hasGear(129)&&(s+=5),r.searchlight&&(s+=7),i.searchlight&&(s+=-5),r.starshell&&(s+=4),i.starshell&&(s+=-10),s}},3486:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(493);class a{constructor(e){this.planes=e,this.calcRate=e=>{const{planes:t}=this,r=e.contactMultiplier,a=((e,t)=>0===t?0:Math.min((e+1)/(70-15*t),1))(Object(i.a)(t.filter(e=>e.is("ReconnaissanceAircraft")),e=>e.contactTriggerFactor),r),s={1.2:0,1.17:0,1.12:0},n=a*t.filter(e=>e.canContact).sort((e,t)=>t.gear.accuracy-e.gear.accuracy).reduce((t,r)=>{const i=(1-t)*r.contactSelectionRate(e),{accuracy:a}=r.gear;return a>=3?s[1.2]+=i:2===a?s[1.17]+=i:s[1.12]+=i,t+i},0),o={1.2:s[1.2]*a,1.17:s[1.17]*a,1.12:s[1.12]*a};return{successRate:n,triggerRate:a,selectionRateMap:s,rateMap:o,airControlState:e}},this.getContactModifier=e=>{if(0===e.contactMultiplier)return 1;const{rateMap:t}=this.calcRate(e),r=Math.random();return r<t[1.2]?1.2:r<t[1.2]+t[1.17]?1.17:r<t[1.2]+t[1.17]+t[1.12]?1.12:1}}}},3504:function(e,t,r){"use strict";r.d(t,"b",(function(){return C})),r.d(t,"a",(function(){return v}));var i=r(47);const a=(...e)=>t=>e.includes(t.gearId),s=(...e)=>t=>e.map(i.b.keyToId).includes(t.categoryId),n=(...e)=>t=>e.every(e=>e(t)),o=s("SmallCaliberMainGun","MediumCaliberMainGun","LargeCaliberMainGun","LargeCaliberMainGun2"),c=s("SmallRadar","LargeRadar","LargeRadar2"),l=n(c,e=>e.los>=5),u=n(c,e=>e.antiAir>=2),h=s("ExtraArmor","MediumExtraArmor","LargeExtraArmor"),d=s("CarrierBasedFighterAircraft","CarrierBasedDiveBomber","CarrierBasedTorpedoBomber","CarrierBasedReconnaissanceAircraft","CarrierBasedReconnaissanceAircraft2"),p=s("ReconnaissanceSeaplane","SeaplaneBomber","SeaplaneFighter","LargeFlyingBoat"),f=s("LandBasedAttackAircraft","LandBasedFighter","LandBasedReconnaissanceAircraft","LargeLandBasedAircraft"),g=s("JetPoweredFighter","JetPoweredFighterBomber","JetPoweredTorpedoBomber","JetPoweredReconnaissanceAircraft"),m=s("CarrierBasedFighterAircraft","SeaplaneFighter","LandBasedFighter","JetPoweredFighter"),A=s("CarrierBasedDiveBomber","SeaplaneBomber","JetPoweredFighterBomber"),y=s("CarrierBasedTorpedoBomber","JetPoweredTorpedoBomber","LandBasedAttackAircraft"),M=s("CarrierBasedReconnaissanceAircraft","CarrierBasedReconnaissanceAircraft2","ReconnaissanceSeaplane","LargeFlyingBoat","JetPoweredReconnaissanceAircraft","LandBasedReconnaissanceAircraft"),b={Abyssal:e=>e.gearId>500,HighAngleMount:e=>16===e.iconId,MainGun:o,Radar:c,SurfaceRadar:l,AirRadar:u,Armor:h,CarrierBasedAircraft:d,Seaplane:p,LandBasedAircraft:f,JetPoweredAircraft:g,Fighter:m,DiveBomber:A,TorpedoBomber:y,ReconnaissanceAircraft:M,FighterBomber:n(s("CarrierBasedDiveBomber"),e=>e.antiAir>=1),Aircraft:((...e)=>t=>e.some(e=>e(t)))(m,A,y,M,s("Autogyro","AntiSubmarinePatrolAircraft")),AntiInstallationBomber:a(60,64,305,306,148,233,277,319,389),AswGear:s("Sonar","DepthCharge","LargeSonar","CarrierBasedDiveBomber","CarrierBasedTorpedoBomber","SeaplaneBomber","Autogyro","AntiSubmarinePatrolAircraft"),AswAircraft:n(e=>e.asw>0,s("CarrierBasedDiveBomber","CarrierBasedTorpedoBomber","SeaplaneBomber","Autogyro","AntiSubmarinePatrolAircraft","LargeFlyingBoat")),DepthChargeProjector:a(44,45),AdditionalDepthCharge:a(226,227),AntiGroundRocketLauncher:a(348,349),Mortar:a(346,347)},S=Object.keys(b);var w={from:e=>{const t=(e=>S.filter(t=>b[t](e)))(e),r=i.b.numberToKey(e.categoryId);return r&&t.push(r),t}};const C=["armor","firepower","torpedo","speed","bombing","antiAir","asw","los","accuracy","evasion","interception","antiBomber","range","radius"];class v{constructor(e,t,r){this.category=t,this.improvable=r,this.radius=0,this.is=e=>this.attrs.includes(e),this.id=e.api_id,this.name=e.api_name,this.categoryId=t.id,this.iconId=e.api_type[3],this.hp=e.api_taik,this.armor=e.api_souk,this.firepower=e.api_houg,this.torpedo=e.api_raig,this.speed=e.api_soku,this.bombing=e.api_baku,this.antiAir=e.api_tyku,this.asw=e.api_tais,this.los=e.api_saku,this.luck=e.api_luck,this.range=e.api_leng;const a=e.api_houm,s=e.api_houk;this.accuracy=0,this.evasion=0,this.antiBomber=0,this.interception=0,this.categoryId===i.a.LandBasedFighter?(this.antiBomber=a,this.interception=s):(this.accuracy=a,this.evasion=s),e.api_distance&&(this.radius=e.api_distance),this.attrs=w.from(this)}get gearId(){return this.id}}},3910:function(e,t,r){"use strict";r.d(t,"a",(function(){return Be}));var i=r(4035),a=r(533),s=r(265),n=r.n(s);class o{constructor(e,t,r,i,s){this.stats=e,this.category=t,this.improvement=r,this.proficiency=i,this.attrs=s,this.is=e=>this.attrs.includes(e),this.match=e=>"number"==typeof e?this.gearId===e:n()(e)(this),this.toState=()=>({gearId:this.gearId,star:this.star,exp:this.exp}),this.calcFighterPower=(e,t=!1)=>{const{antiAir:r,interception:i,antiBomber:s,improvement:n,proficiency:o}=this,c=n.fighterPowerModifier,l=o.fighterPowerBonus;return Object(a.a)({slotSize:e,antiAir:r,interception:i,antiBomber:s,improvementModifier:c,proficiencyModifier:l,isInterception:t})}}get gearId(){return this.stats.gearId}get categoryId(){return this.stats.categoryId}get iconId(){return this.stats.iconId}get name(){return this.stats.name}get improvable(){return this.stats.improvable}get hp(){return this.stats.hp}get firepower(){return this.stats.firepower}get armor(){return this.stats.armor}get torpedo(){return this.stats.torpedo}get antiAir(){return this.stats.antiAir}get speed(){return this.stats.speed}get bombing(){return this.stats.bombing}get asw(){return this.stats.asw}get los(){return this.stats.los}get luck(){return this.stats.luck}get range(){return this.stats.range}get accuracy(){return this.stats.accuracy}get evasion(){return this.stats.evasion}get antiBomber(){return this.stats.antiBomber}get interception(){return this.stats.interception}get radius(){return this.stats.radius}get masterId(){return this.gearId}get star(){return this.improvement.value}get exp(){return this.proficiency.internal}}var c=r(47);class l{constructor(e=0,t,r){this.value=e,this.stats=t,this.gearIs=r}get star(){return this.value}get contactSelectionModifier(){const{value:e,gearIs:t}=this;if(!t("ReconnaissanceAircraft"))return 0;const{los:r}=this.stats;if(t("CarrierBasedReconnaissanceAircraft")||t("CarrierBasedReconnaissanceAircraft2")){if(7===r)return.25*e;if(11===r)return.4*e}else{if(6===r)return.2*e;if(r>=4)return.14*e;if(3===r)return.1*e}return 0}get fighterPowerModifier(){const{star:e,gearIs:t}=this;return t("Fighter")?.2*e:t("FighterBomber")?.25*e:t("LandBasedAttackAircraft")||t("LargeLandBasedAircraft")?.5*Math.sqrt(e):0}get adjustedAntiAirModifier(){const{gearIs:e}=this,{antiAir:t}=this.stats;if(0===t)return 0;let r=0;return e("AntiAircraftGun")?r=t<=7?4:6:(e("AntiAircraftFireDirector")||e("HighAngleMount"))&&(r=t<=7?2:3),r*Math.sqrt(this.value)}get fleetAntiAirModifier(){const{gearIs:e}=this,{antiAir:t}=this.stats;if(0===t)return 0;let r=0;return e("AntiAircraftFireDirector")||e("HighAngleMount")?r=t<=7?2:3:e("AirRadar")&&(r=1.5),r*Math.sqrt(this.value)}get shellingPowerModifier(){const{firepower:e,gearId:t}=this.stats,{gearIs:r}=this;return e>12?1.5*Math.sqrt(this.value):r("CarrierBasedTorpedoBomber")||[10,66,220,275,358].includes(t)?.2*this.value:[12,234,247].includes(t)?.3*this.value:r("MainGun")||r("SecondaryGun")||r("ArmorPiercingShell")||r("AntiAircraftFireDirector")||r("Searchlight")||r("LargeSearchlight")||r("AntiAircraftGun")||r("LandingCraft")||r("SpecialAmphibiousTank")||r("AntiAircraftShell")||r("AntiGroundEquipment")?Math.sqrt(this.value):r("Sonar")||r("LargeSonar")||r("DepthChargeProjector")||r("Mortar")?.75*Math.sqrt(this.value):0}get shellingAccuracyModifier(){const{gearIs:e}=this;return e("SurfaceRadar")?1.7*Math.sqrt(this.value):e("Radar")||e("MainGun")||e("SecondaryGun")||e("ArmorPiercingShell")||e("AntiAircraftFireDirector")?Math.sqrt(this.value):0}get aswPowerModifier(){const{gearIs:e,stats:t,star:r}=this;if(e("CarrierBasedTorpedoBomber"))return.2*r;if(e("DepthCharge")||e("Sonar"))return Math.sqrt(r);if(e("Autogyro")){return(t.asw>10?.3:.2)*r}return 0}get aswAccuracyModifier(){const{star:e}=this;switch(this.stats.categoryId){case c.a.Sonar:case c.a.LargeSonar:case c.a.DepthCharge:return 1.3*Math.sqrt(e)}return 0}get torpedoPowerModifier(){const{star:e}=this;switch(this.stats.categoryId){case c.a.Torpedo:case c.a.AntiAircraftGun:return 1.2*Math.sqrt(e)}return 0}get torpedoAccuracyModifier(){const{star:e}=this;switch(this.stats.categoryId){case c.a.Torpedo:case c.a.MidgetSubmarine:return 2*Math.sqrt(e)}return 0}get torpedoEvasionModifier(){const{star:e,gearIs:t}=this;return t("Sonar")||t("LargeSonar")?1.5*Math.sqrt(e):0}get nightAttackPowerModifier(){const{gearIs:e}=this,{gearId:t}=this.stats;return[10,66,220,275,358].includes(t)?.2*this.value:[12,234,247].includes(t)?.3*this.value:e("MainGun")||e("SecondaryGun")||e("ArmorPiercingShell")||e("AntiAircraftShell")||e("Searchlight")||e("LargeSearchlight")||e("AntiAircraftFireDirector")||e("LandingCraft")||e("SpecialAmphibiousTank")||e("AntiGroundEquipment")||e("Torpedo")||e("MidgetSubmarine")?Math.sqrt(this.value):0}get nightAttackAccuracyModifier(){const{gearIs:e,value:t}=this;return e("SurfaceRadar")?1.6*Math.sqrt(t):e("MediumCaliberMainGun")||e("Radar")?1.3*Math.sqrt(t):0}get effectiveLosModifier(){const{gearIs:e,value:t}=this;return e("SmallRadar")?1.25*Math.sqrt(t):e("LargeRadar")||e("LargeRadar2")?1.4*Math.sqrt(t):e("CarrierBasedReconnaissanceAircraft")||e("CarrierBasedReconnaissanceAircraft2")||e("ReconnaissanceSeaplane")?1.2*Math.sqrt(t):e("SeaplaneBomber")?1.15*Math.sqrt(t):0}get defensePowerModifier(){const{gearIs:e}=this;return e("MediumExtraArmor")?.2*this.value:e("LargeExtraArmor")?.3*this.value:0}}var u=r(471);class h{constructor(e){this.masters=e,this.create=e=>{if(!e)return;const t=this.masters.find(({id:t})=>t===e.masterId);if(!t)return;const r=u.a.from(t.attrs),i=new l(e.improvement,t,t.is),a=new u.b(e.proficiency,r);return new o(t,t.category,i,a,t.attrs)}}}var d=r(493),p=r(3923),f=r(40);const g=e=>{const{los:t,improvement:r}=e;let i=.6;return e.is("CarrierBasedTorpedoBomber")?i=.8:e.is("CarrierBasedReconnaissanceAircraft")||e.is("CarrierBasedReconnaissanceAircraft2")?i=1:e.is("ReconnaissanceSeaplane")?i=1.2:e.is("SeaplaneBomber")&&(i=1.1),i*(t+r.effectiveLosModifier)},m=(e,t,r=!1)=>{const{nakedStats:i,stats:a,totalEquipmentStats:s,gears:n}=e;let o;if(r){const e=n.filter((e,t)=>t!==n.length-1).filter(f.b);o=Object(d.a)(e,g)}else o=s(g);const c=a.getBonus("effectiveLos");return Math.sqrt(i.los+c)+o*t-2};var A=(e,t,r,i)=>e.totalShipStats(e=>m(e,t,i))-Math.ceil(.4*r)+12,y=r(93);const M=e=>[68,166,193,167].includes(e.gearId),b=e=>{switch(e.gearId){case 68:case 193:return.05;case 166:return.02;case 167:return.01}return 0},S=e=>{if(e.category.is("LandingCraft"))return 8;if(e.category.is("CombatRation"))return 1;switch(e.gearId){case 75:return 5;case 167:return 2}return 0},w=e=>e.totalEquipmentStats(S)+(e=>{switch(e){case y.a.SubmarineAircraftCarrier:return 1;case y.a.Destroyer:return 5;case y.a.LightCruiser:return 2;case y.a.AviationCruiser:return 4;case y.a.AviationBattleship:return 7;case y.a.FleetOiler:case y.a.AmphibiousAssaultShip:return 12;case y.a.SeaplaneTender:return 9;case y.a.SubmarineTender:return 7;case y.a.TrainingCruiser:return 6}return 0})(e.shipTypeId)+(487===e.shipId?8:0);class C{constructor(e){this.ships=e,this.totalShipStats=e=>Object(d.a)(this.nonNullableShips,e),this.effectiveLos=(e,t,r)=>A(this,e,t,r)}get nonNullableShips(){return this.ships.filter(f.b)}get planes(){return Object(p.a)(this.nonNullableShips,e=>e.planes)}get hasUnknownSlot(){return this.nonNullableShips.flatMap(e=>e.slots).some(e=>e<0)}get fighterPower(){return Object(d.a)(this.planes.filter(e=>!e.is("ReconnaissanceAircraft")),"fighterPower")}get tp(){return Object(d.a)(this.nonNullableShips,w)}get expeditionBonus(){return(e=>{const t=e.flatMap(e=>e.gears).filter(f.b),r=t.filter(M),i=e.some(e=>487===e.shipId)?.05:0,a=Math.min(Object(d.a)(t,b)+i,.2);return a+.01*a*(r.length&&Object(d.a)(r,e=>e.star)/r.length)+(e=>{var t,r;const i=e.filter(e=>68===e.gearId).length,a=e.filter(e=>193===e.gearId).length;return a<=2?.02*a:3===a?null!==(t=[.05,.05,.052,.054,.054][i])&&void 0!==t?t:.054:null!==(r=[.054,.056,.058,.059,.06][i])&&void 0!==r?r:.06})(t)})(this.nonNullableShips)}get aviationDetectionScore(){return Object(d.a)(this.planes,e=>e.is("LargeFlyingBoat")?e.gear.los*Math.sqrt(e.slotSize):e.is("ReconnaissanceSeaplane")||e.is("SeaplaneBomber")?e.gear.los*Math.sqrt(Math.sqrt(e.slotSize)):0)}}class v{constructor(e){this.shipFactory=e,this.create=e=>{const{ships:t}=e,r=t.map(this.shipFactory.create);return new C(r)}}}class F{constructor(e,t,r){this.gear=e,this.slots=t,this.index=r,this.contactSelectionRate=e=>{const{los:t,improvement:r}=this.gear;return Math.ceil(t+r.contactSelectionModifier)/(20-2*e.contactMultiplier)},this.calcNightAerialAttackPower=(e=!1)=>{const{isNightPlane:t,isNightAircraft:r,gear:i,slotSize:a}=this;if(!r)return 0;const{firepower:s,torpedo:n,asw:o,bombing:c}=i;let l=0,u=.3;t&&(l=3,u=.45);const h=Math.sqrt(i.improvement.value);return s+(e?0:n)+c+l*a+u*(s+n+o+c)*Math.sqrt(a)+h},this.shotdown=e=>{this.slotSize-=e,this.slotSize<0&&(this.slotSize=0)}}get is(){return this.gear.is}get category(){return this.gear.category}get slotSize(){const{slots:e,index:t}=this;return e[t]}set slotSize(e){const{slots:t,index:r}=this;t[r]=e}get fighterPower(){const{gear:e,slotSize:t}=this;return e.calcFighterPower(t)}get interceptionPower(){const{gear:e,slotSize:t}=this;return e.calcFighterPower(t,!0)}get canContact(){return this.is("CarrierBasedTorpedoBomber")||this.is("ReconnaissanceAircraft")}get contactTriggerFactor(){const{gear:e,slotSize:t}=this;return Math.floor(e.los*Math.sqrt(t))}get participatesInAirstrike(){const{slotSize:e}=this;return 0!==e&&(this.is("DiveBomber")||this.is("TorpedoBomber"))}get participatesInCarrierShelling(){const{category:e,slotSize:t}=this;return 0!==t&&e.any("CarrierBasedDiveBomber","CarrierBasedTorpedoBomber","JetPoweredFighterBomber","JetPoweredTorpedoBomber")}get fleetLosModifier(){const{gear:e,slotSize:t}=this;return this.is("ReconnaissanceSeaplane")||this.is("SeaplaneBomber")?e.los*Math.floor(Math.sqrt(t)):0}get isSwordfish(){return this.gear.name.includes("Swordfish")}get isNightFighter(){return 45===this.gear.iconId}get isNightAttacker(){return 46===this.gear.iconId}get isNightPlane(){return this.isNightFighter||this.isNightAttacker}get isNightAircraft(){const{isNightPlane:e,isSwordfish:t,gear:r}=this;return e||t||[154,320].includes(r.gearId)}get fighterCombatResistModifier(){return this.is("JetPoweredAircraft")?.6:1}get adjustedAntiAirResistModifier(){const{gearId:e}=this.gear;return[93,94,143,144,343,99,100,154,319,320,79,80,81,237,170].includes(e)?.6:[322,323,199,200].includes(e)?.5:1}get fleetAntiAirResistModifier(){const{gearId:e}=this.gear;return[100,154,81,237,322,199].includes(e)?.7:[323,200].includes(e)?.5:1}}const B=(e,t)=>{const r=new Array;return e.map((i,a)=>{const s=t[a];i&&s&&s.is("Aircraft")&&r.push(new F(s,e,a))}),r},P=e=>{const{los:t}=e;return e.is("LandBasedReconnaissanceAircraft")?t<=7?1.12:8===t?1.15:1.18:1},k=e=>{const{los:t}=e;return e.is("CarrierBasedReconnaissanceAircraft")||e.is("CarrierBasedReconnaissanceAircraft2")?t<=7?1.2:8===t?1.25:1.3:e.is("LandBasedReconnaissanceAircraft")?1.18:e.is("ReconnaissanceSeaplane")||e.is("LargeFlyingBoat")?t<=7?1.1:8===t?1.13:1.16:1};class I{constructor(e,t){this.slots=e,this.gears=t,this.planes=B(e,t)}get equipments(){return this.gears}get nonNullableGears(){return this.gears.filter(f.b)}get hasPlanes(){return this.nonNullableGears.length>0}get fighterPower(){if(!this.hasPlanes)return 0;const e=Object(d.a)(this.planes,e=>e.fighterPower),t=Math.max(...this.nonNullableGears.map(P));return Math.floor(e*t)}get interceptionPower(){if(!this.hasPlanes)return 0;const e=Object(d.a)(this.planes,e=>e.interceptionPower),t=Math.max(...this.nonNullableGears.map(k));return Math.floor(e*t)}get minCombatRadius(){return this.hasPlanes?Math.min(...this.nonNullableGears.map(e=>e.radius)):0}get combatRadius(){if(!this.hasPlanes)return 0;const{minCombatRadius:e,nonNullableGears:t}=this,r=Math.max(...t.map(e=>e.is("ReconnaissanceAircraft")?e.radius:0));if(r>0){const t=Math.min(Math.sqrt(r-e),3);return Math.round(e+t)}return e}}class T{constructor(e){this.gearFactory=e,this.create=e=>{const{equipments:t}=e,r=e.slots.concat(),i=t.map(this.gearFactory.create);return new I(r,i)}}}var R=r(3914);class L{constructor(e,t,r,i){this.side=e,this.fleetType=t,this.fleets=r,this.landBase=i,this.getFighterPower=(e=!1)=>{const{mainFleet:t,escortFleet:r}=this;if(!t.hasUnknownSlot){if(!e||!r)return t.fighterPower;if(!r.hasUnknownSlot)return t.fighterPower+r.fighterPower}},this.getInterceptionPower=(e=!1)=>{const{mainFleet:t,escortFleet:r}=this;if(t.hasUnknownSlot)return;const i=Object(d.a)(t.planes,e=>e.interceptionPower);return e&&r?r.hasUnknownSlot?void 0:i+Object(d.a)(r.planes,e=>e.interceptionPower):i}}get isCombinedFleetOperation(){return this.fleetType!==R.a.Single}get mainFleet(){return this.fleets[0]}get escortFleet(){if(this.isCombinedFleetOperation)return this.fleets[1]}}class D{constructor(e,t){this.fleetFactory=e,this.landBasedAirCorpsFactory=t}create(e){const{side:t,fleetType:r,fleets:i,landBase:a}=e,s=i.map(this.fleetFactory.create),n=a.map(this.landBasedAirCorpsFactory.create);return new L(t,r,s,n)}}var G=r(3505);const O=(...e)=>t=>e.map(e=>G.a[e]).includes(t.shipClassId),j=O("QueenElizabethClass","NelsonClass","ArkRoyalClass","JClass","TownClass"),q=O("JohnCButlerClass","FletcherClass","IowaClass","LexingtonClass","EssexClass","CasablancaClass","ColoradoClass","NorthamptonClass","AtlantaClass"),E=((...e)=>t=>e.some(e=>e(t)))(e=>147===e.shipId,O("TashkentClass","GangutClass")),N=O("AirfieldPrincess","NorthernPrincess","HarbourPrincess","SupplyDepotPrincess","SupplyDepotSummerPrincess"),x=O("ArtilleryImp"),z=O("IsolatedIslandDemon","IsolatedIslandPrincess"),H={RoyalNavy:j,UsNavy:q,SovietNavy:E,Installation:e=>0===e.speed,SoftSkinned:N,Pillbox:x,SupplyDepot:O("SupplyDepotPrincess","SupplyDepotSummerPrincess"),IsolatedIsland:z,Unremodeled:e=>e.sortId%10==1,Kai:e=>e.name.endsWith("改"),Kai2:e=>e.sortId%10>=6&&e.sortId%10<9},K=Object.keys(H);var V={from:e=>K.filter(t=>H[t](e))};class J{constructor(e,t){this.maxHp=e,this.currentHp=t,this.gte=e=>{const t=this.currentHp/this.maxHp;switch(e){case"Less":return t>=1;case"Shouha":return t>=.75;case"Chuuha":return t>=.5;case"Taiha":return t>=.25}return!0},this.lte=e=>e===this.damage||!this.gte(e)}get damage(){const e=this.currentHp/this.maxHp;return e<=0?"Sunk":e<=.25?"Taiha":e<=.5?"Chuuha":e<=.75?"Shouha":"Less"}get shellingPowerModifier(){switch(this.damage){case"Less":case"Shouha":return 1;case"Chuuha":return.7;case"Taiha":return.4}return 0}get torpedoPowerModifier(){switch(this.damage){case"Less":case"Shouha":return 1;case"Chuuha":return.8}return 0}get aswPowerModifier(){return this.shellingPowerModifier}get nightAttackPowerModifier(){return this.lte("Taiha")?0:this.shellingPowerModifier}}const _={Sparkling:1.2,Normal:1,Orange:.8,Red:.5},U={accuracy:{shelling:_,asw:_,torpedo:{Sparkling:1.3,Normal:1,Orange:.7,Red:.35},night:_},evasion:{Sparkling:.7,Normal:1,Orange:1.2,Red:1.4}};class Y{constructor(e=49){this.value=e,this.getAccuracyModifier=e=>U.accuracy[e][this.state]}get state(){const{value:e}=this;return e>=50?"Sparkling":e>=30?"Normal":e>=20?"Orange":"Red"}get evasionModifier(){return U.evasion[this.state]}}var $=r(3964),Z=r(3510),Q=r(3512),W=r(466),X=r(535),ee=r(54);const te={attrs:"Installation"},re={attrs:"Pillbox"},ie={attrs:"IsolatedIsland"},ae={attrs:"SoftSkinned"},se={shipClassId:G.a.HarbourSummerPrincess},ne={attrs:"SupplyDepot"},oe=(...e)=>({$or:[...e]}),ce=[{gear:{categoryId:c.a.AntiAircraftShell},rules:[{target:oe(ie,se),count1:{a13:1.75}},{target:ae,count1:{a13:2.5}}]},{gear:{categoryId:c.a.ArmorPiercingShell},rules:[{target:re,count1:{a13:1.85}},{target:se,count1:{a13:1.3}}]},{gear:126,rules:[{target:re,count1:{a13:1.6},count2:{a13:2.72}},{target:ie,count1:{a13:1.4},count2:{a13:2.1}},{target:ae,count1:{a13:1.3},count2:{a13:1.82}},{target:se,count1:{a13:1.4},count2:{a13:1.68}},{target:ne,count1:{a5:1.25},count2:{a5:1.625}},{target:te,count1:{b13next:75},count2:{b13next:110},count3:{b13next:140},count4:{b13next:160}}]},{gear:{attrs:"AntiGroundRocketLauncher"},rules:[{target:re,count1:{a13:1.5},count2:{a13:2.7}},{target:ie,count1:{a13:1.3},count2:{a13:2.145}},{target:ae,count1:{a13:1.25},count2:{a13:1.875}},{target:se,count1:{a13:1.25},count2:{a13:1.75}},{target:ne,count1:{a5:1.2},count2:{a5:1.68}}]},{gear:348,rules:[{target:te,count1:{b13next:55},count2:{b13next:115},count3:{b13next:160},count4:{b13next:190}}]},{gear:349,rules:[{target:te,count1:{b13next:80},count2:{b13next:170}}]},{gear:{attrs:"Mortar"},rules:[{target:re,count1:{a13:1.3},count2:{a13:1.95}},{target:ie,count1:{a13:1.2},count2:{a13:1.68}},{target:ae,count1:{a13:1.2},count2:{a13:1.56}},{target:se,count1:{a13:1.1},count2:{a13:1.265}},{target:ne,count1:{a5:1.15},count2:{a5:1.38}}]},{gear:346,rules:[{target:te,count1:{b13next:30},count2:{b13next:55},count3:{b13next:75},count4:{b13next:90}}]},{gear:347,rules:[{target:te,count1:{b13next:60},count2:{b13next:110},count3:{b13next:150},count4:{b13next:180}}]},{gear:{categoryId:c.a.LandingCraft},rules:[{target:oe(re,ie),count1:{a13:1.8}},{target:ae,count1:{a13:1.4}},{target:se,count1:{a13:1.7}},{target:ne,count1:{a5:1.7}}]},{gear:193,rules:[{target:oe(re,ie,ae),count1:{a13:1.15}},{target:se,count1:{a13:1.2}},{target:ne,count1:{a5:1.2}}]},{gear:166,rules:[{target:re,count1:{a13:1.5},count2:{a13:2.1}},{target:ie,count1:{a13:1.2},count2:{a13:1.68}},{target:ae,count1:{a13:1.5},count2:{a13:1.95}},{target:se,count1:{a13:1.6},count2:{a13:2.4}},{target:ne,count1:{a5:1.3},count2:{a5:2.08}}]},{gear:230,rules:[{target:te,count1:{a13:1.8,b13:25}}]},{gear:355,rules:[{target:re,count1:{a13:2}},{target:ie,count1:{a13:1.8}},{target:ae,count1:{a13:1.1}},{target:se,count1:{a13:2}},{target:ne,count1:{a5:1.2}},{target:te,count1:{b13:25,a13next:1.4}}]},{gear:167,rules:[{target:oe(re,ie),count1:{a13:2.4},count2:{a13:3.24}},{target:ae,count1:{a13:1.5},count2:{a13:1.8}},{target:se,count1:{a13:2.8},count2:{a13:4.2}},{target:ne,count1:{a5:1.7},count2:{a5:2.55}}]},{gear:{categoryId:c.a.CarrierBasedDiveBomber},rules:[{target:re,count1:{a13:1.5},count2:{a13:3}},{target:ie,count1:{a13:1.4},count2:{a13:2.45}},{target:se,count1:{a13:1.3}}]},{gear:{categoryId:{$in:[c.a.SeaplaneBomber,c.a.SeaplaneFighter]}},rules:[{target:re,count1:{a13:1.5}},{target:ae,count1:{a13:1.2}},{target:se,count1:{a13:1.3}}]},{ship:{shipTypeId:{$in:[y.a.Destroyer,y.a.LightCruiser]}},target:re,bonus:{a13:1.4}},{ship:{shipTypeId:{$in:[y.a.Submarine,y.a.SubmarineAircraftCarrier]}},target:te,bonus:{b12:30}}],le=(e,t)=>{const r=e.countGear("LandingCraft"),i={};if(r){const a=e.totalEquipmentStats(e=>e.is("LandingCraft")?e.star:0);if(i.a13=1+a/r/50,!t)return i;i.a5=i.a13,e.hasGear(166)&&(i.a5*=i.a5)}return i},ue=(e,t)=>{const r=e.countGear(167),i={};if(r){const a=e.totalEquipmentStats(e=>e.match(167)?e.star:0);if(i.a13=1+a/r/30,!t)return i;i.a5=i.a13}return i},he=(e,t)=>{const r=((e,t)=>{const r=(i,a=0)=>{const s=[];if(!((e,t,r)=>{const{ship:i,target:a}=e;return!(i&&!t.match(i))&&!(a&&!r.match(a))})(i,e,t))return s;const{gear:n,bonus:o,rules:c}=i,l=n?e.countGear(e=>e.match(n)):a;return l&&s.push(((e,t)=>{const{count1:r,count2:i,count3:a,count4:s,count5:n}=e;let o={};return[r,i,a,s,n].forEach((e,r)=>{e&&t>r&&(o=e)}),o})(i,l)),o&&s.push(o),c&&s.push(...c.flatMap(e=>r(e,l))),s};return r})(e,t),i=ce.flatMap(e=>r(e)),a=((e,t)=>{if(!t.isInstallation)return[];const r=t.is("SupplyDepot");return[le(e,r),ue(e,r)]})(e,t);return Object(ee.a)(...i,...a)};class de{constructor(e,t,r,i,a,s,o,c,l){this.master=e,this.stats=t,this.nakedStats=r,this.health=i,this.morale=a,this.slots=s,this.gears=o,this.planes=c,this.attrs=l,this.is=e=>this.attrs.includes(e),this.canEquip=(e,t)=>{const{shipId:r,shipClass:i}=this,{equippable:a,isAbyssal:s}=this.master,{gearId:n,categoryId:o}=e;if(s)return!0;if(!a.categories.includes(o))return!1;if([492,392].includes(r)&&e.is("SeaplaneBomber"))return 194===n;if(this.is("RoyalNavy")&&this.shipType.isBattleshipClass&&e.is("SeaplaneBomber"))return[367,368].includes(n);if(this.slots.length<=t){const e=33;return $.a.includes(o)||a.expantionSlot.includes(n)||n===e}if(i.is("IseClass")&&this.is("Kai2"))return!(t>1&&e.is("MainGun"));if(i.is("YuubariClass")&&this.is("Kai2")){if(t>=3&&(e.is("MainGun")||e.is("Torpedo")||e.is("MidgetSubmarine")))return!1;if(4===t)return e.is("AntiAircraftGun")||e.is("SmallRadar")||e.is("CombatRation")}return!0},this.match=e=>"number"==typeof e?this.shipId===e:n()(e)(this),this.hasGear=e=>{const t=this.nonNullableGears;return"string"==typeof e?t.some(t=>t.is(e)):"number"==typeof e?t.some(({gearId:t})=>t===e):t.some(e)},this.countGear=e=>{const t=this.nonNullableGears;return void 0===e?t.length:"string"==typeof e?t.filter(t=>t.is(e)).length:"number"==typeof e?t.filter(({gearId:t})=>t===e).length:t.filter(e).length},this.totalEquipmentStats=e=>Object(d.a)(this.nonNullableGears,e),this.getDefensePower=()=>{const{armor:e}=this.stats,t=e+this.totalEquipmentStats(e=>e.improvement.defensePowerModifier),r=.7*Math.max(t,1),i=r+.6*Math.floor(t-1);return{min:r,max:i,values:()=>Object(Z.a)(Math.floor(t)).map(e=>r+.6*e),random:()=>r+.6*Object(Q.a)(Math.floor(t-1))}},this.getCruiserFitBonus=()=>{const{shipType:e,shipClass:t,countGear:r}=this,i=e.any("LightCruiser","TorpedoCruiser","TrainingCruiser"),a=t.is("ZaraClass"),s=r(e=>[4,11].includes(e.gearId)),n=r(e=>[65,119,139].includes(e.gearId));return Object(W.a)({isLightCruiserClass:i,singleGunCount:s,twinGunCount:n,isZaraClass:a,zaraGunCount:Math.sqrt(r(162))})},this.getRemainingPlanes=()=>this.planes.filter(f.b),this.getNormalProficiencyModifiers=()=>{const e={power:1,hitRate:0,criticalRate:0};if("CarrierShelling"!==this.getShellingType())return e;const t=this.getRemainingPlanes().filter(e=>e.is("DiveBomber")||e.is("TorpedoBomber")||e.is("LargeFlyingBoat"));e.power=1+Object(d.a)(t,e=>0===e.index?e.gear.proficiency.criticalPowerModifier/100:e.gear.proficiency.criticalPowerModifier/200);const r=Object(d.a)(t,e=>e.gear.proficiency.internal)/t.length;let i=0,a=0;return r>=10&&(i=Math.floor(Math.sqrt(.1*r))),r>=25&&(a=1),r>=40&&(a=2),r>=55&&(a=3),r>=70&&(a=4),r>=80&&(a=6),r>=100&&(a=9),e.hitRate=i+a,e.criticalRate=Object(d.a)(t,e=>{const{internal:t,level:r}=e.gear.proficiency,i=0===e.index?6:0,a=(Math.sqrt(.1*t)+r)/2+1;return Math.floor(a+i)/100}),e},this.getSpecialProficiencyModifiers=()=>{const e={power:1,hitRate:0,criticalRate:0};if("CarrierShelling"!==this.getShellingType())return e;return this.getRemainingPlanes().filter(e=>e.participatesInCarrierShelling&&120===e.gear.proficiency.internal).some(e=>0===e.index)?e.power=1.25:e.power=1.106,e},this.getSpecialEnemyModifiers=e=>he(this,e),this.getAntiInstallationModifier=e=>{const t=this.getSpecialEnemyModifiers(e);return Object.assign(Object.assign({},{a13:1,a13next:1,a5:1,b12:0,b13:0,b13next:0}),t)},this.calcEvasionValue=(e,t)=>{const{evasion:r,luck:i}=this.stats,a=this.totalEquipmentStats(e=>e.is("EngineImprovement")?e.star:0),s=Math.floor(1.5*Math.sqrt(a));return Object(X.a)({evasion:r,luck:i,improvementModifier:s,formationModifier:e,postcapModifier:t})},this.slotCapacities=e.slotCapacities.concat()}get shipId(){return this.master.shipId}get shipClassId(){return this.master.shipClassId}get shipTypeId(){return this.master.shipType.id}get remodelGroup(){return this.master.remodelGroup}get rank(){return this.master.sortId%10}get equipments(){return this.gears}get masterId(){return this.master.shipId}get name(){return this.master.name}get ruby(){return this.master.readingName}get shipClass(){return this.master.shipClass}get shipType(){return this.master.shipType}get level(){return this.nakedStats.level}get shipAccuracy(){const{level:e,luck:t}=this.nakedStats;return 2*Math.sqrt(e)+1.5*Math.sqrt(t)}get fighterPower(){return Object(d.a)(this.planes.filter(({gear:e})=>e.is("Fighter")||e.is("TorpedoBomber")||e.is("DiveBomber")),"fighterPower")}get fleetLosFactor(){return this.nakedStats.los+Object(d.a)(this.planes,e=>e.fleetLosModifier)}get isInstallation(){return 0===this.nakedStats.speed}get installationType(){const{isInstallation:e,name:t}=this;return e?t.includes("砲台")?"Pillbox":t.includes("離島")||t.includes("中枢")?"IsolatedIsland":t.includes("集積")?"SupplyDepot":"SoftSkinned":"None"}get nonNullableGears(){return this.gears.filter(f.b)}get canNightAttack(){const{shipClass:e,shipType:t,health:r,master:i}=this;return!r.lte("Taiha")&&(e.is("ArkRoyalClass")?"Chuuha"!==r.damage&&this.planes.some(e=>e.isSwordfish):i.firepower[0]>0)}getShellingType(){const{shipType:e,shipClass:t,isInstallation:r,hasGear:i}=this;return e.isAircraftCarrierClass||(t.is("RevisedKazahayaClass")||r)&&(i("DiveBomber")||i("TorpedoBomber"))?"CarrierShelling":"Shelling"}}var pe=r(465),fe=r(3924),ge=r(534),me=(r(4053),r(3454)),Ae=r(3963);const ye=["firepower","armor","torpedo","accuracy","evasion","antiAir","asw","speed","los","range","speed","effectiveLos"],Me=(e,t)=>{const r={};for(const i of ye){const a=(e[i]||0)+(t[i]||0);0!==a&&(r[i]=a)}return r},be=e=>{const t=[0,0,(r=e.categoryId,38===r?3:93===r?13:94===r?9:r),e.iconId,0];var r;return{accuracy:e.accuracy,antiAir:e.antiAir,armor:e.armor,asw:e.asw,bombing:e.bombing,evasion:e.evasion,firepower:e.firepower,gearId:e.gearId,los:e.los,name:e.name,radius:e.radius,range:e.range,torpedo:e.torpedo,ace:e.proficiency.level,stars:e.improvement.value,types:t,specialType2:e.categoryId}},Se=(e,t)=>{const r={shipId:e.shipId,stype:e.shipTypeId,ctype:e.shipClassId,yomi:e.ruby},i=t.filter(f.b).map(be);return Object(me.createEquipmentBonuses)(r,i)},we=e=>{const t=e.gears.filter(e=>e&&(e=>!e.is("SmallRadar"))(e));return Se(e,t).los},Ce=e=>{const t=Se(e,e.gears),r=(e=>{if(!e.hasGear(33))return{};const t=Ae.a.getSpeedGroup(e),r=e.countGear(34),i=e.countGear(87),a=Ae.a.getSpeedIncrement(t,r,i);return a>0?{speed:a}:e.shipClassId===G.a.JohnCButlerClass||623===e.shipId?{speed:5}:{}})(e);return[{effectiveLos:we(e)},r].reduce(Me,t)};class ve{constructor(e,t,r={}){this.nakedStats=e,this.gears=t,this.equipmentBonus=r,this.getBonus=e=>{const{equipmentBonus:t}=this;return Object(ge.a)(ye,e)&&t[e]||0}}getStat(e){const{nakedStats:t,gears:r}=this;return t[e]+Object(d.a)(r.filter(f.b),e)+this.getBonus(e)}get hp(){return this.nakedStats.hp}get firepower(){return this.getStat("firepower")}get torpedo(){return this.getStat("torpedo")}get antiAir(){return this.getStat("antiAir")}get armor(){return this.getStat("armor")}get los(){return this.getStat("los")}get asw(){return this.getStat("asw")}get evasion(){return this.getStat("evasion")}get luck(){return this.nakedStats.luck}get speed(){return this.getStat("speed")}get range(){const{nakedStats:e,gears:t,getBonus:r}=this,i=e.range,a=Object(fe.a)(t,"range");return(a&&a.range>i?a.range:i)+r("range")}}class Fe{constructor(e,t){this.masters=e,this.gearFactory=t,this.gearsFrom=(e,t)=>e?e.map(this.gearFactory.create):t.isAbyssal?t.initialEquipment.map(({id:e,improvement:t})=>this.gearFactory.create({masterId:e,improvement:t})):[],this.create=e=>{if(!e)return;const{masterId:t,level:r=1,increased:i,morale:a}=e,s=this.masters.find(e=>e.shipId===t);if(!s)return;const n=this.gearsFrom(e.equipments,s),o=new pe.a(s,r,i),c=new ve(o,n),{currentHp:l=c.hp}=e,u=new J(c.hp,l),h=new Y(a),d=e.slots?e.slots.concat():s.slotCapacities.concat(),p=B(d,n),f=V.from(s),g=new de(s,c,o,u,h,d,n,p,f);return g.stats.equipmentBonus=Ce(g),g}}}class Be{constructor(e=new i.a){this.masterData=e,this.gearFactory=new h(e.gears),this.shipFactory=new Fe(e.ships,this.gearFactory),this.fleetFactory=new v(this.shipFactory),this.landBasedAirCorpsFactory=new T(this.gearFactory),this.operationFactory=new D(this.fleetFactory,this.landBasedAirCorpsFactory)}get createOperation(){return this.operationFactory.create}get createFleet(){return this.fleetFactory.create}get createLandBasedAirCorps(){return this.landBasedAirCorpsFactory.create}get createShip(){return this.shipFactory.create}get createGear(){return this.gearFactory.create}}},3914:function(e,t,r){"use strict";var i;!function(e){e.Single="Single",e.CarrierTaskForce="CarrierTaskForce",e.SurfaceTaskForce="SurfaceTaskForce",e.TransportEscort="TransportEscort",e.Combined="Combined"}(i||(i={})),t.a=i},3921:function(e,t,r){"use strict";var i;!function(e){e.NormalBattle="NormalBattle",e.NightBattle="NightBattle",e.NightToDayBattle="NightToDayBattle",e.AerialBattle="AerialBattle",e.AirDefenseBattle="AirDefenseBattle"}(i||(i={})),t.a=i},3963:function(e,t,r){"use strict";var i;r.d(t,"a",(function(){return a})),function(e){e[e.FastA=0]="FastA",e[e.FastB1SlowA=1]="FastB1SlowA",e[e.FastB2SlowB=2]="FastB2SlowB",e[e.OtherC=3]="OtherC"}(i||(i={}));class a{constructor(e,t){this.value=e,this.name=t,this.add=e=>a.fromNumber(this.value+e)}static getSpeedGroup(e){const{shipType:t,shipClass:r,shipId:s,remodelGroup:n}=e;if(a.fromNumber(e.nakedStats.speed)===a.Fast&&t.is("SeaplaneTender")||t.isSubmarineClass||[115,293].includes(s)||["加賀型","特種船丙型","工作艦","改風早型"].includes(r.name))return i.OtherC;if(["島風型","Ташкент級","大鳳型","翔鶴型","利根型","最上型"].includes(r.name))return i.FastA;if(["阿賀野型","蒼龍型","飛龍型","金剛型","大和型","Iowa級"].includes(r.name))return i.FastB1SlowA;return 181===n||404===n||331===n||541===s?i.FastB1SlowA:i.FastB2SlowB}static getSpeedIncrement(e,t,r){const a=t+r;switch(e){case i.FastA:if(r>=1||a>=2)return 10;break;case i.FastB1SlowA:if(0===r)break;if(a>=3)return 15;if(a>=2)return 10;break;case i.FastB2SlowB:if(r>=2||a>=3)return 10}return a>=1?5:0}}a.Land=new a(0,"陸上"),a.Slow=new a(5,"低速"),a.Fast=new a(10,"高速"),a.FastPlus=new a(15,"高速+"),a.Fastest=new a(20,"最速"),a.fromNumber=e=>{const t=[a.Land,a.Slow,a.Fast,a.FastPlus,a.Fastest].find(t=>e<=t.value);return t||a.Fastest}},3968:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(327),a=r(3512);class s{constructor(e,t,r,i){this.id=e,this.name=t,this.typeFactor=r,this.modifier=i,s.all.push(this)}get api(){return Math.floor(this.id)}get isCarrierSpecialAttack(){return 7===this.api}}s.all=[],s.MainMain=new s(6,"主主",150,{power:1.5,accuracy:1.2}),s.MainApShell=new s(5,"主徹",140,{power:1.3,accuracy:1.3}),s.MainRader=new s(4,"主電",130,{power:1.2,accuracy:1.5}),s.MainSecond=new s(3,"主副",120,{power:1.1,accuracy:1.3}),s.DoubleAttack=new s(2,"連撃",130,{power:1.2,accuracy:1.1}),s.FighterBomberAttacker=new s(7.1,"FBA",125,{power:1.25,accuracy:1}),s.BomberBomberAttacker=new s(7.2,"BBA",140,{power:1.2,accuracy:1}),s.BomberAttacker=new s(7.3,"BA",155,{power:1.15,accuracy:1}),s.getPossibleAircraftCarrierCutins=e=>{const t=new Array,r=e.planes.filter(({slotSize:e})=>e>0),i=r.filter(e=>e.is("CarrierBasedDiveBomber")).length,a=r.some(e=>e.is("CarrierBasedTorpedoBomber"));if(0===i||!a)return t;t.push(s.BomberAttacker),i>=2&&t.push(s.BomberBomberAttacker);return r.some(e=>e.is("CarrierBasedFighterAircraft"))&&t.push(s.FighterBomberAttacker),t.sort((e,t)=>e.typeFactor-t.typeFactor)},s.getPossibleArtillerySpottings=e=>{const t=new Array,r=e.planes.some(e=>e.slotSize>0&&e.is("ReconnaissanceSeaplane")||e.is("SeaplaneBomber")),i=e.countGear(e=>e.is("MainGun"));if(!r||0===i)return t;const a=e.hasGear(e=>e.is("ArmorPiercingShell")),n=e.hasGear(e=>e.is("SecondaryGun")),o=e.hasGear(e=>e.is("Radar"));return i>=2&&(t.push(s.DoubleAttack),a&&t.push(s.MainMain)),n&&(t.push(s.MainSecond),o&&t.push(s.MainRader),a&&t.push(s.MainApShell)),t.sort((e,t)=>t.id-e.id)},s.getPossibleAttacks=(e,t=!1)=>"Taiha"===e.health.damage?[]:e.shipType.isAircraftCarrierClass&&!t?s.getPossibleAircraftCarrierCutins(e):s.getPossibleArtillerySpottings(e),s.calcFleetLosModifier=e=>{const t=e.totalShipStats(e=>e.fleetLosFactor);return Math.floor(Math.sqrt(t)+.1*t)},s.calcBaseValue=(e,t,r,a)=>{const{luck:s}=e.stats,n=Math.floor(Math.sqrt(s)+10),o=e.totalEquipmentStats("los"),c=a?15:0;return r===i.a.AirSupremacy?Math.floor(n+.7*(t+1.6*o)+10)+c:r===i.a.AirSuperiority?Math.floor(n+.6*(t+1.2*o))+c:0},s.calcRate=(e,t,r,i)=>{const a=s.calcBaseValue(e,t,r,i),n=new Map,o=s.getPossibleAttacks(e),c=o.reduce((e,t)=>{let r=(1-e)*(a/t.typeFactor);return r>1&&(r=1),n.set(t,r),e+r},0),l=1-c,u=l<=0,h=o.concat();u||h.unshift(void 0);const d=e=>e?n.get(e)||0:l;return{baseValue:a,attacks:o,rateMap:n,total:c,dayCombatAttacks:h,getAttackRate:d,entries:()=>h.map(e=>[e,d(e)])}},s.try=(e,t,r,i)=>{const n=s.calcBaseValue(e,t,r,i),o=s.getPossibleAttacks(e);for(const e of o)if(n>Object(a.a)(e.typeFactor-1))return e}},40:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"e",(function(){return s})),r.d(t,"a",(function(){return n})),r.d(t,"d",(function(){return o}));const i=e=>null!=e,a=i,s=(e,t)=>t<=e?t:e+Math.sqrt(t-e),n=e=>{const{currentHp:t}=e.health;return t+e.getDefensePower().max},o=e=>e[Math.floor(Math.random()*e.length)]},4014:function(e,t,r){"use strict";var i;!function(e){e[e.None=1501]="None",e[e.Pillbox=1665]="Pillbox",e[e.IsolatedIsland=1668]="IsolatedIsland",e[e.SoftSkinned=1581]="SoftSkinned",e[e.HarbourSummerPrincess=1699]="HarbourSummerPrincess",e[e.SupplyDepot=1655]="SupplyDepot"}(i||(i={})),t.a=i},4015:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(219),a=r(100),s=r(151),n=r(54),o=r(326),c=r(218);class l{constructor({battleState:e,attacker:t,defender:r,specialAttack:i,isCritical:a,remainingAmmoModifier:s,fitGunBonus:n,optionalPowerModifiers:o}){this.battleState=e,this.attacker=t,this.defender=r,this.specialAttack=i,this.isCritical=a,this.remainingAmmoModifier=s,this.fitGunBonus=n,this.optionalPowerModifiers=o,this.attackCalculator=new c.a(t.ship)}get isArmorPiercing(){const e=this.defender.ship.shipType;return e.isBattleshipClass||e.isHeavyCruiserClass||e.any("AircraftCarrier","ArmoredAircraftCarrier")}get proficiencyModifiers(){var e;return this.attackCalculator.getProficiencyModifiers(null===(e=this.specialAttack)||void 0===e?void 0:e.isCarrierSpecialAttack)}get fleetFactors(){const{attacker:e,defender:t}=this;return{power:Object(i.c)(e,t),accuracy:Object(i.b)(e)}}get power(){const{battleState:e,attacker:t,defender:r,fleetFactors:i,specialAttack:a,isCritical:s,isArmorPiercing:o,optionalPowerModifiers:c}=this,{engagement:l}=e,{role:u,formation:h}=t,d=h.getModifiers(u).shelling.power,p=l.modifier,f=t.ship.getSpecialEnemyModifiers(r.ship),g=r.ship.isInstallation,m=Object(n.a)(f,c);return this.attackCalculator.calcPower({formationModifier:d,engagementModifier:p,modifiers:m,fleetFactor:i.power,isCritical:s,isAntiInstallation:g,isArmorPiercing:o,specialAttack:a})}get accuracy(){const{attacker:e,defender:t,fleetFactors:r,isArmorPiercing:i,specialAttack:a,fitGunBonus:s=0}=this;let n=e.formation.getModifiers(e.role).shelling.accuracy;o.a.isIneffective(e.formation,t.formation)&&(n=1);const c=a?a.modifier.accuracy:1;return this.attackCalculator.calcAccuracy({fleetFactor:r.accuracy,formationModifier:n,specialAttackModifier:c,isArmorPiercing:i,fitGunBonus:s})}get defenderEvasionValue(){const{ship:e,formation:t,role:r}=this.defender,i=t.getModifiers(r).shelling.evasion;return e.calcEvasionValue(i)}get hitRate(){const{accuracy:e,defender:t,defenderEvasionValue:r}=this,i=t.ship.morale.evasionModifier;return Object(s.b)({accuracy:e,evasion:r,moraleModifier:i,criticalRateMultiplier:l.criticalRateMultiplier,hitRateBonus:this.proficiencyModifiers.hitRate,criticalRateBonus:this.proficiencyModifiers.criticalRate})}get defensePower(){return this.defender.ship.getDefensePower()}get damage(){const{power:e,defender:t,remainingAmmoModifier:r}=this,i=t.ship.getDefensePower();return new a.a(e.postcap,i,t.ship.health.currentHp,r)}get taihaRate(){const{damage:e,defender:t,hitRate:r,isCritical:i}=this,{currentHp:a,maxHp:s}=t.ship.health,{side:n}=t,o=e=>(a-e)/s<=.25,c=e=>0===e.length?0:e.filter(o).length/e.length,{scratchDamageProbability:l,scratchDamages:u,deadlyDamageProbability:h,stopperDamages:d}=e,p="Player"===n?h:0,f=e.values.filter(e=>!(e<=0)&&!("Player"===n&&a-e<=0)),g=f.length/e.values.length*c(f)+l*c(u)+p*c(d);return i?r.criticalRate*g:r.normalRate*g}get can(){const{attacker:e,defender:t}=this,r=t.ship.isInstallation,{type:i}=this.attackCalculator,{ship:a}=e;if("Sunk"===a.health.damage)return!1;if(t.ship.shipType.isSubmarineClass)return!1;if("CarrierShelling"===i){if(a.health.lte("Taiha"))return!1;if(!a.shipType.is("ArmoredAircraftCarrier")&&a.health.lte("Chuuha"))return!1;const e=a.planes.filter(e=>e.slotSize>0);return(!r||!e.some(e=>e.is("DiveBomber")&&!e.is("AntiInstallationBomber")))&&a.planes.some(e=>e.participatesInCarrierShelling)}return!a.shipType.isSubmarineClass||!r||a.hasGear("SpecialAmphibiousTank")}}l.criticalRateMultiplier=1.3},4016:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(100),a=r(151),s=r(485);class n{constructor({battleState:e,attacker:t,defender:r,isCritical:i,remainingAmmoModifier:a=1}){this.battleState=e,this.attacker=t,this.defender=r,this.isCritical=i,this.remainingAmmoModifier=a,this.attackCalculator=new s.a(t.ship)}get power(){const{battleState:e,attacker:t,defender:r,isCritical:i}=this,{engagement:a}=e,{formation:s}=t,n=s.shellingSupportModifiers.power,o=a.modifier,c=r.ship.isInstallation;return this.attackCalculator.calcPower({formationModifier:n,engagementModifier:o,isCritical:i,isAntiInstallation:c})}get accuracy(){const e=this.attacker.formation.shellingSupportModifiers.accuracy;return this.attackCalculator.calcAccuracy({formationModifier:e})}get defenderEvasionValue(){const{ship:e,formation:t,role:r}=this.defender,i=t.getModifiers(r).shelling.evasion;return e.calcEvasionValue(i)}get hitRate(){const{accuracy:e,defender:t,defenderEvasionValue:r}=this,i=t.ship.morale.evasionModifier;return Object(a.b)({accuracy:e,evasion:r,moraleModifier:i,criticalRateMultiplier:n.criticalRateMultiplier})}get damage(){const{power:e,defender:t,remainingAmmoModifier:r}=this,a=t.ship.getDefensePower();return new i.a(e.postcap,a,t.ship.health.currentHp,r)}}n.criticalRateMultiplier=1.1},4017:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(151),a=r(326),s=r(100),n=r(487);class o{constructor({attacker:e,defender:t,engagement:r,isCritical:i=!1,time:s="Day",remainingAmmoModifier:o=1,optionalPowerModifiers:c}){this.isPossible=()=>{const{defender:e,attackCalculator:t}=this;return!!e.ship.shipType.isSubmarineClass&&"None"!==t.type},this.getFormationModifiers=()=>{const{attacker:e,defender:t}=this,{power:r,accuracy:i}=e.formation.getModifiers(e.role).asw,{evasion:s}=t.formation.getModifiers(t.role).asw,n={power:r,accuracy:i,evasion:s};return a.a.isIneffective(e.formation,t.formation)?Object.assign(Object.assign({},n),{accuracy:1}):n},this.attacker=e,this.defender=t,this.engagement=r,this.isCritical=i,this.time=s,this.remainingAmmoModifier=o,this.optionalPowerModifiers=c,this.attackCalculator=n.a.fromShip(e.ship,s)}get power(){const{isCritical:e,optionalPowerModifiers:t}=this,r=this.getFormationModifiers().power,i=this.engagement.modifier;return this.attackCalculator.calcPower({formationModifier:r,engagementModifier:i,isCritical:e,optionalModifiers:t})}get accuracy(){const e=this.getFormationModifiers().accuracy;return this.attackCalculator.calcAccuracy({formationModifier:e})}get evasion(){const e=this.getFormationModifiers().evasion;return this.defender.ship.calcEvasionValue(e)}get hitRate(){const{accuracy:e,defender:t,evasion:r}=this,a=t.ship.morale.evasionModifier,s=o.criticalRateMultiplier;return Object(i.b)({accuracy:e,evasion:r,moraleModifier:a,criticalRateMultiplier:s})}get damage(){const{power:e,defender:t,remainingAmmoModifier:r}=this,i=t.ship.getDefensePower(),{armorPenetration:a}=this.attackCalculator;return new s.a(e.postcap,i,t.ship.health.currentHp,r,a)}}o.cap=170,o.criticalRateMultiplier=1.1},4018:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(151),a=r(219),s=r(486),n=r(100);class o{constructor({attacker:e,defender:t,engagement:r,isCritical:i=!1,remainingAmmoModifier:a=1,innateTorpedoAccuracy:n=0,optionalPowerModifiers:o}){this.getFormationModifiers=()=>{const{attacker:e,defender:t}=this;return{attacker:e.formation.getModifiers(e.role).torpedo,defender:t.formation.getModifiers(t.role).torpedo}},this.attacker=e,this.defender=t,this.engagement=r,this.isCritical=i,this.remainingAmmoModifier=a,this.innateTorpedoAccuracy=n,this.optionalPowerModifiers=o,this.attackCalculator=s.a.fromShip(e.ship)}get power(){const{isCritical:e,optionalPowerModifiers:t}=this,r=Object(a.d)(this.attacker,this.defender),i=this.getFormationModifiers().attacker.power,s=this.engagement.modifier;return this.attackCalculator.calcPower({fleetFactor:r,formationModifier:i,engagementModifier:s,isCritical:e,optionalModifiers:t})}get accuracy(){const e=Math.floor(.2*this.power.preCritical),t=this.getFormationModifiers().attacker.accuracy,{innateTorpedoAccuracy:r}=this;return this.attackCalculator.calcAccuracy({formationModifier:t,powerModifier:e,innateTorpedoAccuracy:r})}get evasion(){const{ship:e}=this.defender,t=this.getFormationModifiers().defender.evasion,r=e.totalEquipmentStats(e=>e.improvement.torpedoEvasionModifier);return e.calcEvasionValue(t,r)}get hitRate(){const{accuracy:e,defender:t,evasion:r}=this,a=t.ship.morale.evasionModifier,{criticalRateMultiplier:s}=o;return Object(i.b)({accuracy:e,evasion:r,moraleModifier:a,criticalRateMultiplier:s})}get damage(){const{power:e,defender:t,remainingAmmoModifier:r}=this,i=t.ship.getDefensePower();return new n.a(e.postcap,i,t.ship.health.currentHp,r)}}o.cap=170,o.criticalRateMultiplier=1.5,o.isPossible=(e,t)=>0!==e.nakedStats.torpedo&&!t.isInstallation},4019:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(488),a=r(100),s=r(151),n=r(54);class o{constructor({attacker:e,defender:t,specialAttack:r,isCritical:a,starshell:s,searchlight:n,nightContactModifier:o,remainingAmmoModifier:c,optionalPowerModifiers:l}){this.attacker=e,this.defender=t,this.specialAttack=r,this.isCritical=a,this.starshell=s,this.searchlight=n,this.nightContactModifier=o,this.remainingAmmoModifier=c,this.optionalPowerModifiers=l,this.attackCalculator=new i.a(e.ship)}get contactModifiers(){return 5===this.nightContactModifier?{power:5,accuracy:1.1,criticalRate:1.57}:{power:0,accuracy:1,criticalRate:o.criticalRateMultiplier}}get accuracy(){const{attacker:e,specialAttack:t,starshell:r,searchlight:i}=this,{formation:a,role:s}=e,n=a.getModifiers(s).night.accuracy,o=null==t?void 0:t.modifier.accuracy,c=this.contactModifiers.accuracy,l=r?5:0,u=i?7:0;return this.attackCalculator.calcAccuracy({starshellModifier:l,contactModifier:c,searchlightModifier:u,formationModifier:n,specialAttackModifier:o})}get power(){const{attacker:e,defender:t,isCritical:r,specialAttack:i,optionalPowerModifiers:a}=this,{role:s,formation:o}=e,c=o.getModifiers(s).night.power,l=t.ship.isInstallation,u=e.ship.getSpecialEnemyModifiers(t.ship),h=Object(n.a)(u,a);return this.attackCalculator.calcPower({nightContactModifier:this.contactModifiers.power,formationModifier:c,specialAttack:i,isCritical:r,isAntiInstallation:l,modifiers:h})}get defenderEvasionValue(){const{ship:e,formation:t,role:r}=this.defender,i=t.getModifiers(r).night.evasion,a=e.shipType.isHeavyCruiserClass?5:0;return e.calcEvasionValue(i,a)}get hitRate(){const{accuracy:e,defender:t,defenderEvasionValue:r,contactModifiers:i}=this,a=t.ship.morale.evasionModifier;return Object(s.b)({accuracy:e,evasion:r,moraleModifier:a,criticalRateMultiplier:i.criticalRate})}get defensePower(){return this.defender.ship.getDefensePower()}get damage(){const{power:e,defensePower:t,remainingAmmoModifier:r,defender:i}=this;return new a.a(e.postcap,t,i.ship.health.currentHp,r)}}o.criticalRateMultiplier=1.5},4020:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t,r){this.id=e,this.name=t,this.modifier=r,i.values.push(this)}}i.values=[],i.Parallel=new i(1,"同航戦",1),i.HeadOn=new i(2,"反航戦",.8),i.CrossingTheTAdvantage=new i(3,"T有利",1.2),i.CrossingTheTDisadvantage=new i(4,"T不利",.6),i.random=(e=!1)=>{const t=Math.random();return t<.15?i.CrossingTheTAdvantage:t<.6?i.Parallel:t<.9||e?i.HeadOn:i.CrossingTheTDisadvantage}},4025:function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));var i=r(327),a=r(3486),s=r(54),n=r(100),o=r(151);class c{constructor({plane:e,target:t,contactModifier:r,proficiencyModifiers:i}){this.calcPower=e=>{const{slotSize:t,stat:r,typeModifier:i,contactModifier:a,proficiencyModifiers:n}=this,o=i*(r*Math.sqrt(t)+0),c={a11:a},l=e?Object(s.c)(n.power):void 0;return Object(s.b)({basic:o,cap:170,modifiers:c,fm11next:l})},this.getHitRate=()=>{const{accuracy:e,evasion:t,proficiencyModifiers:r,target:i}=this,a=i.morale.evasionModifier,s=r.hitRate,n=r.criticalRate;return Object(o.b)({accuracy:e,evasion:t,moraleModifier:a,hitRateBonus:s,criticalRateMultiplier:.2,criticalRateBonus:n})},this.getDamage=e=>{const{target:t}=this,{postcap:r}=this.calcPower(e);return new n.a(r,t.getDefensePower(),t.health.currentHp)},this.do=()=>{const e=this.getHitRate(),t=Object(o.c)(e);if("Miss"===t)return;const r=this.getDamage("Critical"===t);this.target.health.currentHp-=r.random()},this.plane=e,this.target=t,this.contactModifier=r,this.proficiencyModifiers=i}get slotSize(){return this.plane.slotSize}get type(){const{is:e}=this.plane;return e("JetPoweredFighterBomber")?"JetPoweredFighterBomber":e("DiveBomber")?"DiveBomber":e("TorpedoBomber")?"TorpedoBomber":"None"}get stat(){const{plane:e}=this;return e.is("DiveBomber")?e.gear.bombing:e.is("TorpedoBomber")?e.gear.torpedo:0}get typeModifier(){const{type:e}=this;return"JetPoweredFighterBomber"===e?1/Math.sqrt(2):"DiveBomber"===e?1:"TorpedoBomber"===e?Math.random()>.5?.8:1.5:0}get accuracy(){return 95}get evasion(){return this.target.calcEvasionValue(1)}}var l=r(40);class u{constructor(e,t,r,i){this.playerFleet=e,this.enemyFleet=t,this.enemyFormation=r,this.contactModifier=i,this.getTarget=()=>{const e=this.enemyFleet.nonNullableShips.filter(e=>!e.shipType.isSubmarineClass),t=Object(l.d)(e),r=e[0];if(t!==r)return t;if(!(Math.random()<this.enemyFormation.protectionRate))return t;const i=e.filter(e=>e!==t&&!e.isInstallation&&"Less"===e.health.damage);return 0===i.length?t:Object(l.d)(i)},this.do=()=>{const{playerFleet:e,contactModifier:t}=this;e.nonNullableShips.forEach(e=>{const r=e.getNormalProficiencyModifiers();e.planes.filter(u.isAirstrikePlane).forEach(e=>{const i=this.getTarget();new c({plane:e,target:i,contactModifier:t,proficiencyModifiers:r}).do()})})}}}u.isAirstrikePlane=e=>e.slotSize>0&&(e.is("TorpedoBomber")||e.is("DiveBomber"));var h=r(210),d=r(257);const p=(e,t)=>{const r=i.a.fromFighterPower(e.fighterPower,t.fighterPower),a=r.constant;return e.planes.filter(e=>e.is("DiveBomber")||e.is("TorpedoBomber")||e.is("Fighter")).forEach(e=>{const{slotSize:t}=e,r=(({slotSize:e,airControlStateConstant:t,side:r,fighterCombatResistModifier:i})=>{let a;if("Player"===r){const e=t/4,r=Math.floor(t/3*100);a=Math.floor(Math.random()*(r+1))/100+e}else{const e=11-t;a=.35*Math.floor(Math.random()*(e+1))+.65*Math.floor(Math.random()*(e+1))}const s=a/10;return Math.floor(e*s*i)})({slotSize:t,airControlStateConstant:a,side:"Player",fighterCombatResistModifier:1});e.shotdown(r)}),r},f=e=>{const{playerFleet:t,enemyFleet:r,enemyFormation:i}=e,s=p(t,r),n=new a.a(t.planes).getContactModifier(s);(({playerFleet:e,enemyFleet:t,enemyFormation:r})=>{const i=e.planes.filter(u.isAirstrikePlane),a=h.a.calcFleetAntiAir(t,"Enemy",r.fleetAntiAirModifier);i.forEach(e=>{const r=Object(l.d)(t.nonNullableShips),i=new d.a(r,"Enemy",a).getShotdownNumber(e);e.shotdown(i)})})(e);return new u(t,r,i,n).do(),s};class g{constructor(){this.Less=0,this.Shouha=0,this.Chuuha=0,this.Taiha=0,this.Sunk=0,this.increase=({health:e})=>{this[e.damage]+=1}}get total(){return this.Less+this.Shouha+this.Chuuha+this.Taiha+this.Sunk}get lessRate(){return this.Less/this.total}get shouhaRate(){return this.Shouha/this.total}get chuuhaRate(){return this.Chuuha/this.total}get taihaRate(){return this.Taiha/this.total}get sunkRate(){return this.Sunk/this.total}}class m{constructor(){this.countMap=new Map,this.increase=({slotSize:e})=>{var t;const r=null!==(t=this.countMap.get(e))&&void 0!==t?t:0;this.countMap.set(e,r+1)},this.entries=()=>{const{total:e,countMap:t}=this;return Array.from(t.entries(),([t,r])=>[t,r/e])}}get total(){let e=0;return this.countMap.forEach(t=>{e+=t}),e}}class A{constructor(e){this.ship=e,this.init=()=>{const{ship:e,initialSlots:t}=this;e.health.currentHp=this.initialHp,t.forEach((t,r)=>{e.slots[r]=t})},this.initialHp=e.health.currentHp,this.initialSlots=e.slots.concat()}}class y{constructor(e){this.init=()=>{this.shipInitialStates.forEach(e=>e.init())},this.shipInitialStates=e.nonNullableShips.map(e=>new A(e))}}var M=r(4036);class b{constructor(e){this.creater=e,this.data=new Map,this.update=e=>{let t=this.data.get(e);t||(t=this.creater(),this.data.set(e,t)),t.increase(e)},this.entries=()=>Array.from(this.data.entries())}}class S{constructor(){this.data=new Map,this.increase=e=>{const t=this.data.get(e);t?this.data.set(e,t+1):this.data.set(e,1)},this.getRate=e=>{var t;return(null!==(t=this.data.get(e))&&void 0!==t?t:0)/this.total},this.getRateList=()=>{const e=[];this.data.forEach((t,r)=>{e.push([r,this.getRate(r)])});let t=0;return e.sort(([e],[t])=>t-e).map(([e,r])=>(t+=r,[e,r,t]))}}get total(){let e=0;return this.data.forEach(t=>{e+=t}),e}}class w{constructor(){this.damageLog=new b(()=>new g),this.planeLossLog=new b(()=>new m),this.sunkCounter=new S,this.update=(e,t)=>{t.nonNullableShips.forEach(e=>{this.damageLog.update(e)});const r=t.nonNullableShips.filter(e=>"Sunk"===e.health.damage).length;this.sunkCounter.increase(r),e.planes.forEach(e=>{this.planeLossLog.update(e)})}}}class C{constructor(e,t,r){this.playerFleet=e,this.enemyFleet=t,this.enemyFormation=r,this.record=new w,this.init=()=>{const{playerFleet:e,enemyFleet:t}=this.initialState;e.init(),t.init()},this.once=()=>{const{playerFleet:e,enemyFleet:t,enemyFormation:r}=this;f({playerFleet:e,enemyFleet:t,enemyFormation:r});this.record.update(e,t),this.init()},this.do=e=>(Object(M.a)(e,this.once),this.record),this.initialState={playerFleet:new y(e),enemyFleet:new y(t)}}}},4035:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r(3959),a=r(3961),s=r(3962),n=r(47),o=r(3504);const c=e=>"number"==typeof e?[e,e]:e;class l{constructor(e,t,r){this.shipType=t,this.shipClass=r,this.getNextShip=()=>{if(this.canRemodel)return l.all.find(e=>this.remodel.nextId===e.shipId)},this.getPrevShip=()=>l.all.find(e=>e.remodel.nextId===this.shipId&&e.rank<this.rank),this.getRemodelGroupShips=()=>l.all.filter(e=>e.remodelGroup===this.remodelGroup),this.shipId=e.id,this.shipClassId=r.id,this.sortNo=e.sortNo,this.sortId=e.sortId,this.name=e.name,this.readingName=e.readingName,this.hp=c(e.hp),this.armor=c(e.armor),this.firepower=c(e.firepower),this.torpedo=c(e.torpedo),this.antiAir=c(e.antiAir),this.luck=c(e.luck),this.asw=c(e.asw),this.evasion=c(e.evasion),this.los=c(e.los),this.speed=e.speed,this.range=e.range,this.fuel=e.fuel,this.ammo=e.ammo,this.slotCapacities=e.slotCapacities.concat(),this.initialEquipment=e.equipments.map(e=>"number"==typeof e?{id:e,improvement:0}:e),e.remodel?this.remodel=e.remodel:this.remodel={nextId:0,nextLevel:0};const i=e.equippable?e.equippable:{};this.equippable=Object.assign({categories:this.shipType.equippableCategoryIds,expantionSlot:[]},i),l.all.push(this)}get isAbyssal(){return this.shipId>l.abyssalIdFrom}get canRemodel(){return this.remodel.nextId>0}get canConvert(){if(!this.canRemodel)return!1;const e=this.getNextShip();if(!e)return!1;if(e.remodel.nextId===this.shipId)return!0;const t=e.getNextShip();return!!t&&t.remodel.nextId===this.shipId}get remodelGroup(){if(this.remodelGroupMemo)return this.remodelGroupMemo;let e=this.shipId,t=this.getPrevShip();for(;t;)e=t.shipId,t=t.getPrevShip();return this.remodelGroupMemo=e,e}get rank(){return this.sortId%10}}l.all=new Array,l.abyssalIdFrom=1500;var u=r(470),h=r(3960),d=r(93);class p{constructor(e,t,r){this.id=e,this.name=t,this.equippableCategoryIds=r,this.is=e=>this.id===d.a[e],this.any=(...e)=>e.some(this.is),e===d.a.Battlecruiser&&(this.name="巡洋戦艦")}get isDestroyer(){return this.id===d.a.Destroyer}get isLightCruiserClass(){return this.any("LightCruiser","TorpedoCruiser","TrainingCruiser")}get isHeavyCruiserClass(){return this.any("HeavyCruiser","AviationCruiser")}get isBattleshipClass(){return this.any("Battlecruiser","Battleship","AviationBattleship","SuperDreadnoughts")}get isAircraftCarrierClass(){return this.any("LightAircraftCarrier","AircraftCarrier","ArmoredAircraftCarrier")}get isSubmarineClass(){return[d.a.Submarine,d.a.SubmarineAircraftCarrier].includes(this.id)}}p.all=h.a.map(e=>{const t=Object.entries(e.api_equip_type).filter(([e,t])=>1===t).map(([e,t])=>Number(e));return new p(e.api_id,e.api_name,t)}),p.fromId=e=>{const t=p.all.find(t=>t.id===e);if(t)return t;const r=new p(e,"",[]);return p.all.push(r),r};class f{constructor(e=i.a){this.shipsData=e,this.findMasterGear=e=>this.gears.find(t=>t.id===e),this.findMasterShip=e=>this.ships.find(t=>t.shipId===e),this.shipIdToName=e=>{const t=this.ships.find(t=>t.shipId===e);return t?t.name:""},this.shipNameToId=e=>{const t=this.ships.find(t=>t.name===e);return t?t.shipId:0},this.shipClassIdToName=e=>u.a.fromId(e).name,this.shipTypeIdToName=e=>p.fromId(e).name,this.gearIdToName=e=>{const t=this.findMasterGear(e);return t?t.name:""},this.gearNameToId=e=>{const t=this.gears.find(t=>t.name===e);return t&&t.id},this.gears=a.a.map(e=>{const t=e.api_id,r=e.api_type[2],i=n.b.find(r,t),a=s.a.includes(t);return new o.a(e,i,a)}),this.ships=e.map(e=>{const t=p.fromId(e.shipTypeId),r=u.a.fromId(e.classId);return new l(e,t,r)})}}},45:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t,r){this.id=e,this.key=t,this.name=r,i.values.push(this)}get isCombined(){return this!==i.Single}}i.values=[],i.Single=new i(0,"Single","通常艦隊"),i.CarrierTaskForce=new i(1,"CarrierTaskForce","空母機動部隊"),i.SurfaceTaskForce=new i(2,"SurfaceTaskForce","水上打撃部隊"),i.TransportEscort=new i(3,"TransportEscort","輸送護衛部隊"),i.Combined=new i(5,"Combined","敵連合"),i.fromId=e=>i.values.find(t=>t.id===e),i.fromString=e=>i.values.find(t=>t.key===e||t.name===e)},465:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return s}));var i=r(186);const a=["hp","firepower","armor","torpedo","evasion","antiAir","asw","speed","los","range","luck"];class s{constructor(e,t,r){this.master=e,this.level=t,this.increased=r}getIncreasedStat(e){const{increased:t}=this;if(!t)return 0;const r=t[e];return r?r>1e5?1e5:r:0}get hp(){return Object(i.a)(this.master.hp,this.level)+this.getIncreasedStat("hp")}get firepower(){return this.master.firepower[1]+this.getIncreasedStat("firepower")}get torpedo(){return this.master.torpedo[1]+this.getIncreasedStat("torpedo")}get antiAir(){return this.master.antiAir[1]+this.getIncreasedStat("antiAir")}get armor(){return this.master.armor[1]+this.getIncreasedStat("armor")}get los(){return Object(i.b)(this.master.los,this.level)+this.getIncreasedStat("los")}get asw(){return Object(i.b)(this.master.asw,this.level)+this.getIncreasedStat("asw")}get evasion(){return Object(i.b)(this.master.evasion,this.level)+this.getIncreasedStat("evasion")}get luck(){return this.master.luck[0]+this.getIncreasedStat("luck")}get speed(){return this.master.speed+this.getIncreasedStat("speed")}get range(){return this.master.range+this.getIncreasedStat("range")}}},466:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a}));const i=e=>{const t={power:1,accuracy:1},{hasArmorPiercingShell:r,hasMainGun:i,hasRader:a,hasSecondaryGun:s}=e;return r&&i?s&&a?{power:1.15,accuracy:1.3}:s?{power:1.15,accuracy:1.2}:a?{power:1.1,accuracy:1.25}:{power:1.08,accuracy:1.1}:t},a=e=>{const{isLightCruiserClass:t,isZaraClass:r,singleGunCount:i,twinGunCount:a,zaraGunCount:s}=e;return t?Math.sqrt(i)+2*Math.sqrt(a):r?Math.sqrt(s):0}},47:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}));var i,a=r(3913);!function(e){e[e.SmallCaliberMainGun=1]="SmallCaliberMainGun",e[e.MediumCaliberMainGun=2]="MediumCaliberMainGun",e[e.LargeCaliberMainGun=3]="LargeCaliberMainGun",e[e.SecondaryGun=4]="SecondaryGun",e[e.Torpedo=5]="Torpedo",e[e.CarrierBasedFighterAircraft=6]="CarrierBasedFighterAircraft",e[e.CarrierBasedDiveBomber=7]="CarrierBasedDiveBomber",e[e.CarrierBasedTorpedoBomber=8]="CarrierBasedTorpedoBomber",e[e.CarrierBasedReconnaissanceAircraft=9]="CarrierBasedReconnaissanceAircraft",e[e.ReconnaissanceSeaplane=10]="ReconnaissanceSeaplane",e[e.SeaplaneBomber=11]="SeaplaneBomber",e[e.SmallRadar=12]="SmallRadar",e[e.LargeRadar=13]="LargeRadar",e[e.Sonar=14]="Sonar",e[e.DepthCharge=15]="DepthCharge",e[e.ExtraArmor=16]="ExtraArmor",e[e.EngineImprovement=17]="EngineImprovement",e[e.AntiAircraftShell=18]="AntiAircraftShell",e[e.ArmorPiercingShell=19]="ArmorPiercingShell",e[e.VTFuze=20]="VTFuze",e[e.AntiAircraftGun=21]="AntiAircraftGun",e[e.MidgetSubmarine=22]="MidgetSubmarine",e[e.EmergencyRepairPersonnel=23]="EmergencyRepairPersonnel",e[e.LandingCraft=24]="LandingCraft",e[e.Autogyro=25]="Autogyro",e[e.AntiSubmarinePatrolAircraft=26]="AntiSubmarinePatrolAircraft",e[e.MediumExtraArmor=27]="MediumExtraArmor",e[e.LargeExtraArmor=28]="LargeExtraArmor",e[e.Searchlight=29]="Searchlight",e[e.SupplyTransportContainer=30]="SupplyTransportContainer",e[e.ShipRepairFacility=31]="ShipRepairFacility",e[e.SubmarineTorpedo=32]="SubmarineTorpedo",e[e.StarShell=33]="StarShell",e[e.CommandFacility=34]="CommandFacility",e[e.AviationPersonnel=35]="AviationPersonnel",e[e.AntiAircraftFireDirector=36]="AntiAircraftFireDirector",e[e.AntiGroundEquipment=37]="AntiGroundEquipment",e[e.LargeCaliberMainGun2=38]="LargeCaliberMainGun2",e[e.SurfaceShipPersonnel=39]="SurfaceShipPersonnel",e[e.LargeSonar=40]="LargeSonar",e[e.LargeFlyingBoat=41]="LargeFlyingBoat",e[e.LargeSearchlight=42]="LargeSearchlight",e[e.CombatRation=43]="CombatRation",e[e.Supplies=44]="Supplies",e[e.SeaplaneFighter=45]="SeaplaneFighter",e[e.SpecialAmphibiousTank=46]="SpecialAmphibiousTank",e[e.LandBasedAttackAircraft=47]="LandBasedAttackAircraft",e[e.LandBasedFighter=48]="LandBasedFighter",e[e.LandBasedReconnaissanceAircraft=49]="LandBasedReconnaissanceAircraft",e[e.TransportationMaterial=50]="TransportationMaterial",e[e.SubmarineEquipment=51]="SubmarineEquipment",e[e.LargeLandBasedAircraft=53]="LargeLandBasedAircraft",e[e.JetPoweredFighter=56]="JetPoweredFighter",e[e.JetPoweredFighterBomber=57]="JetPoweredFighterBomber",e[e.JetPoweredTorpedoBomber=58]="JetPoweredTorpedoBomber",e[e.JetPoweredReconnaissanceAircraft=59]="JetPoweredReconnaissanceAircraft",e[e.LargeRadar2=93]="LargeRadar2",e[e.CarrierBasedReconnaissanceAircraft2=94]="CarrierBasedReconnaissanceAircraft2"}(i||(i={}));class s{constructor(e,t){this.id=e,this.name=t,this.is=e=>this.id===i[e],this.any=(...e)=>e.some(this.is)}static find(e,t){128===t||281===t?e=i.LargeCaliberMainGun2:142===t?e=i.LargeRadar2:151===t&&(e=i.CarrierBasedReconnaissanceAircraft2);const r=s.all.find(t=>t.id===e);if(r)return r;const a=new s(e,"");return this.all.push(a),a}}s.keyToId=e=>i[e],s.numberToKey=e=>{const t=i[e];if(void 0!==t)return t},s.all=a.a.map(({api_id:e,api_name:t})=>new s(e,t))},470:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(3505);const a=Object.entries(i.b).filter(e=>"number"==typeof e[1]);class s{constructor(e,t){this.name=e,this.id=t,this.is=e=>this.id===i.a[e],this.any=(...e)=>e.some(this.is)}static fromId(e){const t=s.all.find(t=>t.id===e);if(t)return t;const r=new s("unknown",e);return s.all.push(r),r}get isSpecialTypeDestroyer(){return this.any("FubukiClass","AyanamiClass","AkatsukiClass")}get isUsNavy(){return this.any("JohnCButlerClass","FletcherClass","IowaClass","LexingtonClass","EssexClass","CasablancaClass","ColoradoClass")}get isRoyalNavy(){return this.any("QueenElizabethClass","NelsonClass","ArkRoyalClass","JClass")}}s.all=a.map(e=>new s(...e))},471:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var i=r(3924);const a=(e,t)=>{const r=Object(i.a)(e.filter(e=>e.level<=t),"value");return r?r.value:0},s={from:e=>{const t=t=>e.includes(t);return t("Fighter")?"Fighter":t("SeaplaneBomber")?"SeaplaneBomber":t("DiveBomber")||t("TorpedoBomber")||t("ReconnaissanceAircraft")||t("CarrierBasedAircraft")||t("Seaplane")||t("JetPoweredAircraft")||t("LandBasedAircraft")?"Other":"None"}};class n{constructor(e=0,t){this.internal=e,this.type=t}static internalToLevel(e){return n.internalBounds.filter(t=>t<=e).length-1}get visible(){return"None"!==this.type}get level(){return n.internalToLevel(this.internal)}set level(e){this.internal=n.internalBounds[e]}get fighterPowerBonus(){const{internal:e,level:t,type:r}=this;if(e<=0)return 0;let i=[];"Fighter"===r?i=n.fighterPowerLevelBonuses.fighter:"SeaplaneBomber"===r&&(i=n.fighterPowerLevelBonuses.seaplaneBomber);return a(i,t)+Math.sqrt(e/10)}get criticalPowerModifier(){const{internal:e,level:t}=this,r=a(n.criticalModifierLevelBonuses,t);return Math.floor(Math.sqrt(e)+r)}}n.internalBounds=[0,10,25,40,55,70,85,100],n.fighterPowerLevelBonuses={fighter:[{level:7,value:22},{level:5,value:14},{level:4,value:9},{level:3,value:5},{level:2,value:2},{level:0,value:0}],seaplaneBomber:[{level:7,value:6},{level:5,value:3},{level:2,value:1},{level:0,value:0}]},n.criticalModifierLevelBonuses=[{level:7,value:10},{level:6,value:7},{level:5,value:5},{level:4,value:4},{level:3,value:3},{level:2,value:2},{level:1,value:1},{level:0,value:0}]},485:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(54),a=r(218);class s{constructor(e){this.ship=e,this.getCarrierShellingFm=(e=!1)=>{const{ship:t,type:r}=this;if("Shelling"===r)return;const i=e?0:t.totalEquipmentStats("torpedo"),a=e?t.totalEquipmentStats(e=>e.is("AntiInstallationBomber")?e.bombing:0):t.totalEquipmentStats("bombing"),s=Math.floor(Math.floor(1.3*a)+i)+15;return e=>25+Math.floor(1.5*(e+s))},this.calcPower=e=>{const{ship:t}=this,{formationModifier:r,engagementModifier:a,isCritical:s,isAntiInstallation:n}=e,o=4+t.stats.firepower,c={a14:r*a*t.health.shellingPowerModifier},l=this.getCarrierShellingFm(n),u=s?Object(i.c)():void 0;return Object(i.b)({basic:o,cap:170,modifiers:c,fm14prev:l,fm11next:u})},this.calcAccuracy=e=>{const{shipAccuracy:t,equipmentAccuracy:r,moraleModifier:i}=this.accuracyShipFactors,{formationModifier:a}=e,s=Math.floor(64+t+r);return Math.floor(s*a*i)}}get type(){return Object(a.b)(this.ship)}get accuracyShipFactors(){const{ship:e}=this,{shipAccuracy:t}=e;return{shipAccuracy:t,equipmentAccuracy:e.totalEquipmentStats("accuracy"),moraleModifier:e.morale.getAccuracyModifier("shelling")}}}},486:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(54);class a{constructor(e){this.state=e,this.calcPower=e=>(e=>{const{torpedo:t,improvementModifier:r,healthModifier:a,fleetFactor:s,formationModifier:n,engagementModifier:o,isCritical:c,optionalModifiers:l}=e,u=n*o*a,h=Object(i.a)({a14:u},l),d=t+r+s,p=Object(i.b)({basic:d,cap:180,modifiers:h}),f=p.postcap;if(!c)return Object.assign(Object.assign({},p),{preCritical:f});const g=Math.floor(1.5*p.postcap);return Object.assign(Object.assign({},p),{preCritical:f,postcap:g})})(Object.assign(Object.assign({},this.state.power),e)),this.calcAccuracy=e=>(e=>{const{shipAccuracy:t,equipmentAccuracy:r,improvementModifier:i,powerModifier:a,innateTorpedoAccuracy:s,formationModifier:n,moraleModifier:o}=e,c=85+t+r+i+a+s;return Math.floor(c*n*o)})(Object.assign(Object.assign({},this.state.accuracy),e))}}a.fromShip=e=>{const{shipAccuracy:t}=e,r={power:{torpedo:e.stats.torpedo,improvementModifier:e.totalEquipmentStats(e=>e.improvement.torpedoPowerModifier),healthModifier:e.health.torpedoPowerModifier},accuracy:{shipAccuracy:t,equipmentAccuracy:e.totalEquipmentStats("accuracy"),improvementModifier:e.totalEquipmentStats(e=>e.improvement.torpedoAccuracyModifier),moraleModifier:e.morale.getAccuracyModifier("torpedo")}};return new a(r)}},487:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r(270),a=r(54);const s=e=>{const{hasGear:t}=e;let r=1,i=1;return(t("Sonar")||t("LargeSonar"))&&t("DepthCharge")&&(r=1.15),t("AdditionalDepthCharge")&&t("DepthChargeProjector")&&(i=t("Sonar")?1.25:1.1),r*i},n=e=>{const t=e.shipType.is("CoastalDefenseShip")?1:0;return e.totalEquipmentStats(e=>e.is("AdditionalDepthCharge")?Math.sqrt(e.asw-2)+t:0)};class o{constructor(e){this.state=e,this.calcBasicPower=(e=0)=>{const{nakedAsw:t,equipmentAsw:r,improvementModifier:i,typeConstant:a}=this.state.power;return 2*Math.sqrt(t)+1.5*r+i+a},this.calcPower=e=>{const{proficiencyModifier:t}=this.state.power;let r;return e.isCritical&&(r=Object(a.c)(t)),i.a.createPower(Object.assign(Object.assign(Object.assign({},this.state.power),e),{fm11next:r}))},this.calcAccuracy=e=>i.a.calcAccuracy(Object.assign(Object.assign({},this.state.accuracy),e))}get armorPenetration(){return this.state.armorPenetration}get type(){return this.state.type}}o.fromShip=(e,t)=>{const r=((e,t)=>{const{shipAccuracy:r}=e,i=((e,t=!1)=>!t&&(e=>!(!e.shipType.any("AviationCruiser","AviationBattleship","SeaplaneTender","LightAircraftCarrier","AmphibiousAssaultShip")&&!e.shipClass.is("RevisedKazahayaClass")&&646!==e.shipId)&&e.planes.some(e=>e.slotSize>0&&e.is("AswAircraft")))(e)?"AircraftCarrier":(e=>0!==e.nakedStats.asw&&!e.shipClass.any("FusouClass","IseClass","R1"))(e)?"DepthCharge":"None")(e,"Night"===t),a=e.totalEquipmentStats(e=>e.is("Sonar")?2*e.asw:e.is("AdditionalDepthCharge")?e.asw:0);let o=1;return"AircraftCarrier"!==i||"Opening"===t||e.shipClass.is("RevisedKazahayaClass")||(o=e.getNormalProficiencyModifiers().power),{power:{nakedAsw:e.nakedStats.asw,equipmentAsw:e.totalEquipmentStats(e=>e.is("AswGear")?e.asw:0),improvementModifier:e.totalEquipmentStats(e=>e.improvement.aswPowerModifier),typeConstant:"DepthCharge"===i?13:8,healthModifier:e.health.aswPowerModifier,synergyModifier:s(e),proficiencyModifier:o},accuracy:{shipAccuracy:r,aswEquipmentModifier:a,improvementModifier:e.totalEquipmentStats(e=>e.improvement.aswAccuracyModifier),moraleModifier:e.morale.getAccuracyModifier("asw")},armorPenetration:n(e),type:i}})(e,t);return new o(r)}},488:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(493),a=r(54),s=r(3459);class n{constructor(e){this.ship=e,this.calcNightAerialAttackPower=e=>{const{ship:t,type:r}=this;return"NightAerialAttack"!==r?0:t.nakedStats.firepower+Object(i.a)(t.planes,t=>t.calcNightAerialAttackPower(e))},this.calcBasicPower=(e,t)=>{const{ship:r,type:i}=this,{firepower:a}=r.stats,s=t?0:r.stats.torpedo,n=r.totalEquipmentStats(e=>e.improvement.nightAttackPowerModifier);return"NightAerialAttack"===i?this.calcNightAerialAttackPower(t)+e:a+s+n+e},this.getCriticalFm=()=>{if("NightAerialAttack"===this.type){const e=this.ship.getNormalProficiencyModifiers();return Object(a.c)(e.power)}return Object(a.c)()},this.calcPower=e=>{const{nightContactModifier:t,formationModifier:r,specialAttack:i,isCritical:s,isAntiInstallation:n}=e,o=this.calcBasicPower(t,n),c=this.ship.health.nightAttackPowerModifier;let l=1,u=1;i&&(l=i.modifier.power,i.isDestroyerCutin&&(u=this.typeDModifier));const h=r*c*l*u,d=this.ship.getCruiserFitBonus(),p=Object(a.a)({a14:h,b14:d},e.modifiers),f=s?this.getCriticalFm():void 0;return Object(a.b)({basic:o,cap:360,modifiers:p,fm11next:f})},this.calcAccuracy=e=>{const{starshellModifier:t,contactModifier:r,searchlightModifier:i,formationModifier:a,specialAttackModifier:s=1,fitGunBonus:n=0}=e,{ship:o}=this,{shipAccuracy:c,shipType:l,hasGear:u}=o,h=o.totalEquipmentStats("accuracy"),d=o.totalEquipmentStats(e=>e.improvement.nightAttackAccuracyModifier),p=o.morale.getAccuracyModifier("night");let f=0;l.isHeavyCruiserClass&&(u(6)&&(f=10),(u(90)||u(50))&&(f=15));const g=Math.floor((69+t)*r+c+h+d);return Math.floor(g*a*p*s+i+f+n)}}get type(){const{ship:e}=this;return Object(s.b)(e)?"NightAerialAttack":"NightAttack"}get typeDModifier(){const{ship:e}=this,t=e.countGear(267),r=e.countGear(366),i=t+r;let a=1;return 0===i||(1===i&&(a=1.25),i>=2&&(a=1.4),r&&(a*=1.05)),a}}},489:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r(40),a=r(3924),s=r(3512);const n=e=>{if(Array.isArray(e)){const t=e.map(n);return Object(a.a)(t,e=>e&&e.id)}{const t=e,r=Object(s.a)(100);return c.getPossibleAntiAirCutins(t).find(e=>e.isSpecialAaci()?e.probability>Object(s.a)(100):e.probability>r)}};var o=n;class c{constructor(e,t,r,i){this.id=e,this.minimumBonus=t,this.fixedAirDefenseModifier=r,this.probability=i,this.isSpecialAaci=()=>[34,35,39,40,41].includes(this.id)}static fromId(e){return this.all.find(t=>t.id===e)}}c.all=[[1,8,1.7,65],[2,7,1.7,58],[3,5,1.6,50],[4,7,1.5,52],[5,5,1.5,55],[6,5,1.45,40],[7,4,1.35,45],[8,5,1.4,50],[9,3,1.3,40],[10,9,1.65,60],[11,7,1.5,55],[12,4,1.25,45],[13,5,1.35,35],[14,5,1.45,63],[15,4,1.3,58],[16,5,1.4,60],[17,3,1.25,55],[18,3,1.2,60],[19,6,1.45,55],[20,4,1.25,70],[21,6,1.45,60],[22,3,1.2,63],[23,2,1.05,80],[24,4,1.25,60],[25,8,1.55,60],[26,7,1.4,60],[28,5,1.4,53],[29,6,1.55,58],[30,4,1.3,42],[31,3,1.25,50],[32,4,1.2,32],[33,4,1.35,42],[34,8,1.6,60],[35,7,1.55,53],[36,7,1.55,59],[37,5,1.45,38],[39,11,1.7,60],[40,11,1.7,60],[41,10,1.65,60]].map(e=>new c(...e)),c.try=o,c.getPossibleAntiAirCutins=e=>(e=>{const{shipId:t,hasGear:r}=e;let i;!function(e){e[e.MayaKai2=428]="MayaKai2",e[e.IsuzuKai2=141]="IsuzuKai2",e[e.KasumiKai2B=470]="KasumiKai2B",e[e.KinuKai2=487]="KinuKai2",e[e.YuraKai2=488]="YuraKai2",e[e.MusashiKai=148]="MusashiKai",e[e.MusashiKai2=546]="MusashiKai2",e[e.IsokazeBKai=557]="IsokazeBKai",e[e.HamakazeBKai=558]="HamakazeBKai",e[e.SatsukiKai2=418]="SatsukiKai2",e[e.FumizukiKai2=548]="FumizukiKai2",e[e.Uit25=539]="Uit25",e[e.I504=530]="I504",e[e.TatsutaKai2=478]="TatsutaKai2"}(i||(i={}));const a=t=>e.masterId===t,s=e=>e.is("HighAngleMount"),n=e=>s(e)&&e.antiAir>=8,o=e=>s(e)&&e.antiAir<8,c=e=>e.is("Radar"),l=e=>e.is("AirRadar"),u=e=>e.is("AntiAircraftGun"),h=e=>u(e)&&e.antiAir>=9,d=e=>u(e)&&e.antiAir>=3&&e.antiAir<9,p=e=>274===e.gearId,f=e=>275===e.gearId,g=e=>e.is("AntiAircraftShell"),m=e=>e.is("AntiAircraftFireDirector"),A=e=>e.category.any("LargeCaliberMainGun","LargeCaliberMainGun2"),y=(t,r)=>e.countGear(t)>=r,M=t=>e.hasGear(t),b=[];if(e.shipClass.is("FletcherClass")){const t=e.countGear(313),r=e.countGear(284)+t,i=e.countGear(308);i>=2&&b.push(34),i>0&&r>0&&b.push(35),r>=2&&e.hasGear(307)&&b.push(36),t>=2&&b.push(37)}const S=e.countGear(363),w=e.countGear(362)+S;return e.shipClass.is("AtlantaClass")&&w>=2&&(S>=1&&b.push(39),e.hasGear(307)&&b.push(40),b.push(41)),e.shipClass.is("AkizukiClass")&&M(s)?(y(s,2)&&M(c)&&b.push(1),M(c)&&b.push(2),y(s,2)&&b.push(3)):(a(i.MayaKai2)&&M(s)&&M(h)&&(M(l)&&b.push(10),b.push(11)),a(i.IsuzuKai2)&&M(s)&&M(u)&&(M(l)&&b.push(14),b.push(15)),a(i.KasumiKai2B)&&M(s)&&M(u)&&(M(l)&&b.push(16),b.push(17)),622===t&&r("HighAngleMount")&&r("AntiAircraftGun")&&r("AirRadar")&&b.push(16),a(i.KinuKai2)&&M(h)&&M(o)&&b.push(19),a(i.YuraKai2)&&M(s)&&M(l)&&b.push(21),e.shipClass.is("IseClass")&&e.shipType.is("AviationBattleship")&&M(p)&&M(g)&&M(l)&&b.push(25),M(m)&&M(A)&&M(g)&&M(l)&&b.push(4),y(n,2)&&M(l)&&b.push(5),M(m)&&M(A)&&M(g)&&b.push(6),M(n)&&M(l)&&b.push(8),M(m)&&M(s)&&M(l)&&b.push(7),a(i.MusashiKai2)&&M(f)&&M(l)&&b.push(26),(e.shipClass.is("IseClass")&&e.shipType.is("AviationBattleship")||a(i.MusashiKai)||a(i.MusashiKai2))&&M(p)&&M(l)&&b.push(28),(a(i.IsokazeBKai)||a(i.HamakazeBKai))&&M(s)&&M(l)&&b.push(29),M(m)&&M(s)&&b.push(9),[579,630].includes(e.shipId)&&e.hasGear(s)&&e.hasGear(e=>e.is("AntiAircraftGun")&&e.antiAir>=4)&&b.push(33),M(h)&&M(l)&&e.countGear(e=>e.is("AntiAircraftGun")&&e.antiAir>=3)>=2&&b.push(12),M(n)&&M(h)&&M(l)&&b.push(13),a(i.SatsukiKai2)&&M(h)&&b.push(18),a(i.KinuKai2)&&M(h)&&b.push(20),a(i.FumizukiKai2)&&M(h)&&b.push(22),(a(i.Uit25)||a(i.I504))&&M(d)&&b.push(23),["龍田改二","天龍改二"].includes(e.name)&&M(s)&&M(d)&&b.push(24),["天龍改二","Gotland改"].includes(e.name)&&e.countGear(s)>=3&&b.push(30),"天龍改二"===e.name&&e.countGear(s)>=2&&b.push(31),(e.shipClass.isRoyalNavy||e.shipClass.is("KongouClass")&&e.name.includes("改二"))&&(e.countGear(301)>=2||e.hasGear(301)&&e.hasGear(191)||e.hasGear(300)&&e.hasGear(191))&&b.push(32)),b})(e).map(e=>c.fromId(e)).filter(i.b)},491:function(e,t,r){"use strict";var i;!function(e){e.MainFleet="MainFleet",e.EscortFleet="EscortFleet"}(i||(i={})),t.a=i},533:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=({slotSize:e,antiAir:t,interception:r=0,antiBomber:i=0,improvementModifier:a=0,proficiencyModifier:s=0,isInterception:n=!1})=>{let o=t+1.5*r+a;return n&&(o=t+r+2*i+a),Math.floor(o*Math.sqrt(e)+s)}},534:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=(e,t)=>e.includes(t)},535:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=e=>{const{evasion:t,luck:r,improvementModifier:i,formationModifier:a,postcapModifier:s=0,additionalFm:n}=e,o=Math.floor((t+Math.sqrt(2*r))*a);let c=o;o>=65?c=Math.floor(55+2*Math.sqrt(o-65)):o>=40&&(c=Math.floor(40+3*Math.sqrt(o-40)));const l=Math.floor(c+s)+i;return n?n(l):l}},54:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return c}));var i=r(492),a=r(40);const s=(...e)=>{const t={};return e.forEach(e=>e&&((e,t)=>{Object.entries(t).forEach(([t,r])=>{if("number"!=typeof r)return;let i;i=t.startsWith("a")?(e[t]||1)*r:(e[t]||0)+r,e[t]=i})})(t,e)),t},n=(e=1,t=0,r=!1)=>i=>{const a=i*e+t;return r?Math.floor(a):a},o=(e=1)=>t=>Math.floor(1.5*t*e),c=({basic:e,cap:t,modifiers:r,fm14prev:s,fm11next:o})=>{const c=((e,t)=>{const{a12:r,a13:a,a13next:s,a14:o,b12:c,b13:l,b13next:u,b14:h}=e,d=n(r,c),p=n(a,l),f=n(s,u),g=n(o,h);return t?Object(i.a)(d,p,f,t,g):Object(i.a)(d,p,f,g)})(r,s),l=(e=>{const{a5:t,a6:r,a11:a,b5:s,b6:o,b11:c}=e,l=n(t,s,!0),u=n(r,o,!0),h=n(a,c);return Object(i.a)(l,u,h)})(r),u=c(e),h=t<u,d=Object(a.e)(t,u);let p=l(d);return o&&(p=o(p)),{precap:u,isCapped:h,capped:d,postcap:p}}},69:function(e,t,r){"use strict";r.r(t);var i=r(466);r.d(t,"getApShellModifiers",(function(){return i.b})),r.d(t,"calcCruiserFitBonus",(function(){return i.a}));var a=r(533);r.d(t,"calcFighterPower",(function(){return a.a}));var s=r(186);r.d(t,"calcStatAtLevel",(function(){return s.b})),r.d(t,"calcHpAtLevel",(function(){return s.a}));var n=r(270);r.d(t,"Asw",(function(){return n.a}));var o=r(151);r.d(t,"calcHitRateBasis",(function(){return o.a})),r.d(t,"createHitRate",(function(){return o.b})),r.d(t,"getHitStatus",(function(){return o.c}));var c=r(535);r.d(t,"calcEvasionValue",(function(){return c.a}))},93:function(e,t,r){"use strict";var i;!function(e){e[e.CoastalDefenseShip=1]="CoastalDefenseShip",e[e.Destroyer=2]="Destroyer",e[e.LightCruiser=3]="LightCruiser",e[e.TorpedoCruiser=4]="TorpedoCruiser",e[e.HeavyCruiser=5]="HeavyCruiser",e[e.AviationCruiser=6]="AviationCruiser",e[e.LightAircraftCarrier=7]="LightAircraftCarrier",e[e.Battlecruiser=8]="Battlecruiser",e[e.Battleship=9]="Battleship",e[e.AviationBattleship=10]="AviationBattleship",e[e.AircraftCarrier=11]="AircraftCarrier",e[e.SuperDreadnoughts=12]="SuperDreadnoughts",e[e.Submarine=13]="Submarine",e[e.SubmarineAircraftCarrier=14]="SubmarineAircraftCarrier",e[e.Transport=15]="Transport",e[e.SeaplaneTender=16]="SeaplaneTender",e[e.AmphibiousAssaultShip=17]="AmphibiousAssaultShip",e[e.ArmoredAircraftCarrier=18]="ArmoredAircraftCarrier",e[e.RepairShip=19]="RepairShip",e[e.SubmarineTender=20]="SubmarineTender",e[e.TrainingCruiser=21]="TrainingCruiser",e[e.FleetOiler=22]="FleetOiler"}(i||(i={})),t.a=i}}]);